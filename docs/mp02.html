<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maria Cristina Moreno">

<title>Making Backyards Affordable for All – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7426e6c918677667253820780600aeba.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Making Backyards Affordable for All</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Maria Cristina Moreno </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This project explores the dynamics between housing growth and rent burden across U.S. metropolitan areas using data from the U.S. Census Bureau (ACS) and Bureau of Labor Statistics (BLS). By combining demographic, income, and construction permit data, the analysis investigates how new housing development influences affordability and population trends over time. Through the construction of standardized indices for rent burden and housing growth, as well as the creation of a composite measure, the project identifies cities exhibiting “YIMBY” (Yes In My Backyard) characteristics — regions where increased housing supply has coincided with reduced rent pressures and sustained population growth. Visualizations and data transformations in R (tidyverse, ggplot2, tidycensus) provide a data-driven perspective on housing policy outcomes and urban development patterns. ## Section Overview</p>
<p>In this section:</p>
<ol type="1">
<li><p>Construct rent burden and housing growth metrics from ACS and BLS data.</p></li>
<li><p>Standardize both indicators to a 0–100 scale for comparability.</p></li>
<li><p>Visualize trends and relationships between rent burden, housing growth, and population change.</p></li>
<li><p>Identify CBSAs showing “YIMBY” outcomes — high initial rent burden, declining rents, population growth, and strong housing development.</p></li>
<li><p>Interpret results to understand how housing supply influences affordability across U.S. cities.</p></li>
<li><p>Develop a concise <strong>policy brief</strong> summarizing the key findings, highlighting data-driven evidence on housing growth and affordability. The brief serves as an “elevator pitch” for proposed legislation supporting sustainable housing development, with hypothetical congressional sponsors representing major urban centers such as Houston, TX and New York, NY.</p></li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,279 × 4
   GEOID NAME                                           household_income  year
   &lt;dbl&gt; &lt;chr&gt;                                                     &lt;dbl&gt; &lt;dbl&gt;
 1 10140 Aberdeen, WA Micro Area                                   36345  2009
 2 10180 Abilene, TX Metro Area                                    42931  2009
 3 10300 Adrian, MI Micro Area                                     45640  2009
 4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area            13470  2009
 5 10420 Akron, OH Metro Area                                      47482  2009
 6 10500 Albany, GA Metro Area                                     36218  2009
 7 10540 Albany-Lebanon, OR Micro Area                             47669  2009
 8 10580 Albany-Schenectady-Troy, NY Metro Area                    57677  2009
 9 10700 Albertville, AL Micro Area                                37284  2009
10 10740 Albuquerque, NM Metro Area                                46824  2009
# ℹ 7,269 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,279 × 4
   GEOID NAME                                           monthly_rent  year
   &lt;dbl&gt; &lt;chr&gt;                                                 &lt;dbl&gt; &lt;dbl&gt;
 1 10140 Aberdeen, WA Micro Area                                 650  2009
 2 10180 Abilene, TX Metro Area                                  712  2009
 3 10300 Adrian, MI Micro Area                                   645  2009
 4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area          363  2009
 5 10420 Akron, OH Metro Area                                    723  2009
 6 10500 Albany, GA Metro Area                                   624  2009
 7 10540 Albany-Lebanon, OR Micro Area                           761  2009
 8 10580 Albany-Schenectady-Troy, NY Metro Area                  833  2009
 9 10700 Albertville, AL Micro Area                              579  2009
10 10740 Albuquerque, NM Metro Area                              726  2009
# ℹ 7,269 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,279 × 4
   GEOID NAME                                           population  year
   &lt;dbl&gt; &lt;chr&gt;                                               &lt;dbl&gt; &lt;dbl&gt;
 1 10140 Aberdeen, WA Micro Area                             71797  2009
 2 10180 Abilene, TX Metro Area                             160266  2009
 3 10300 Adrian, MI Micro Area                               99837  2009
 4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area     342495  2009
 5 10420 Akron, OH Metro Area                               699935  2009
 6 10500 Albany, GA Metro Area                              164238  2009
 7 10540 Albany-Lebanon, OR Micro Area                      116584  2009
 8 10580 Albany-Schenectady-Troy, NY Metro Area             857592  2009
 9 10700 Albertville, AL Micro Area                          90399  2009
10 10740 Albuquerque, NM Metro Area                         856216  2009
# ℹ 7,269 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,279 × 4
   GEOID NAME                                           households  year
   &lt;dbl&gt; &lt;chr&gt;                                               &lt;dbl&gt; &lt;dbl&gt;
 1 10140 Aberdeen, WA Micro Area                             27759  2009
 2 10180 Abilene, TX Metro Area                              58052  2009
 3 10300 Adrian, MI Micro Area                               36835  2009
 4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area      91805  2009
 5 10420 Akron, OH Metro Area                               281769  2009
 6 10500 Albany, GA Metro Area                               60101  2009
 7 10540 Albany-Lebanon, OR Micro Area                       43953  2009
 8 10580 Albany-Schenectady-Troy, NY Metro Area             336492  2009
 9 10700 Albertville, AL Micro Area                          32651  2009
10 10740 Albuquerque, NM Metro Area                         334647  2009
# ℹ 7,269 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,658 × 3
    CBSA new_housing_units_permitted  year
   &lt;dbl&gt;                       &lt;dbl&gt; &lt;dbl&gt;
 1 10180                         214  2009
 2 10420                         741  2009
 3 10500                         213  2009
 4 10580                        1380  2009
 5 10740                        1692  2009
 6 10780                         396  2009
 7 10900                        1648  2009
 8 11020                         125  2009
 9 11100                         642  2009
10 11180                         122  2009
# ℹ 5,648 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 801 × 8
   level1_title   level2_title level3_title level4_title level1_code level2_code
   &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;      
 1 Agriculture, … Crop produc… Oilseed and… Soybean far…          11 111        
 2 Agriculture, … Crop produc… Oilseed and… Oilseed (ex…          11 111        
 3 Agriculture, … Crop produc… Oilseed and… Dry pea and…          11 111        
 4 Agriculture, … Crop produc… Oilseed and… Wheat farmi…          11 111        
 5 Agriculture, … Crop produc… Oilseed and… Corn farming          11 111        
 6 Agriculture, … Crop produc… Oilseed and… Rice farming          11 111        
 7 Agriculture, … Crop produc… Oilseed and… Other grain…          11 111        
 8 Agriculture, … Crop produc… Vegetable a… Vegetable a…          11 111        
 9 Agriculture, … Crop produc… Fruit and t… Orange grov…          11 111        
10 Agriculture, … Crop produc… Fruit and t… Citrus (exc…          11 111        
# ℹ 791 more rows
# ℹ 2 more variables: level3_code &lt;chr&gt;, level4_code &lt;chr&gt;</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,442,181 × 6
    YEAR FIPS  INDUSTRY EMPLOYMENT TOTAL_WAGES AVG_WAGE
   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;
 1  2009 C1018      101       8050   342280951   42519.
 2  2009 C1018     1011       1769    86660038   48988.
 3  2009 C1018     1012       3328   151822573   45620.
 4  2009 C1018     1013       2952   103798340   35162.
 5  2009 C1018      102      42334  1284997543   30354.
 6  2009 C1018     1021      11993   368955371   30764.
 7  2009 C1018     1022          0           0      NA 
 8  2009 C1018     1023       3575   138206437   38659.
 9  2009 C1018     1024       4697   149886226   31911.
10  2009 C1018     1025      11950   452254692   37846.
# ℹ 4,442,171 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,279 × 4
   GEOID NAME                                           households  year
   &lt;dbl&gt; &lt;chr&gt;                                               &lt;dbl&gt; &lt;dbl&gt;
 1 10140 Aberdeen, WA Micro Area                             27759  2009
 2 10180 Abilene, TX Metro Area                              58052  2009
 3 10300 Adrian, MI Micro Area                               36835  2009
 4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area      91805  2009
 5 10420 Akron, OH Metro Area                               281769  2009
 6 10500 Albany, GA Metro Area                               60101  2009
 7 10540 Albany-Lebanon, OR Micro Area                       43953  2009
 8 10580 Albany-Schenectady-Troy, NY Metro Area             336492  2009
 9 10700 Albertville, AL Micro Area                          32651  2009
10 10740 Albuquerque, NM Metro Area                         334647  2009
# ℹ 7,269 more rows</code></pre>
</div>
</div>
<section id="data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h2>
<p>This project uses data primarily from the U.S. Census Bureau and the Bureau of Labor Statistics (BLS). The Census Bureau conducts multiple ongoing surveys in addition to the decennial census, the most important being the American Community Survey (ACS), which continuously tracks household, demographic, and economic indicators across the country.</p>
<p>To simplify access and ensure consistency, data was downloaded and cleaned using the tidycensus R package. All analyses are performed at the Core-Based Statistical Area (CBSA) level — geographic units that represent metropolitan or micropolitan regions surrounding a central urban core. For example, the New York-Newark-Jersey City, NY-NJ CBSA encompasses the wider New York metropolitan region.</p>
<p>Additionally, data from the Bureau of Labor Statistics (BLS) was integrated to provide employment and income context using the North American Industry Classification System (NAICS) codes. These combined datasets enable a comprehensive view of how housing, income, and population dynamics interact across urban regions. <img src="housing_price.jpeg" class="img-fluid quarto-figure quarto-figure-center" style="width:100.0%" alt="Housing Price"></p>
</section>
<section id="data-integration-and-initial-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-integration-and-initial-exploration">Data Integration and Initial Exploration</h2>
<p>Now that all datasets have been successfully downloaded, cleaned, and merged, this step focuses on performing an initial analysis to become familiar with the structure, variables, and relationships within the data. The goal here is not to produce final insights, but rather to build fluency with the tables and ensure a solid understanding of what information is available.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Question 1">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Aggregate permits for 2010–2019 by CBSA</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>permits_agg <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">between</span>(year, <span class="dv">2010</span>, <span class="dv">2019</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(CBSA) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Lookup table: latest CBSA name per GEOID (avoids duplicates over time)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>cbsa_lookup <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(GEOID, year) <span class="sc">|&gt;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Attach name and select the top CBSA</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>largest_new_housing_CBSA <span class="ot">&lt;-</span> permits_agg <span class="sc">|&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(cbsa_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">coalesce</span>(NAME, <span class="fu">as.character</span>(CBSA))) <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(total_units, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Helper scalars for inline printing</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>top_name  <span class="ot">&lt;-</span> largest_new_housing_CBSA<span class="sc">$</span>NAME</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>top_units <span class="ot">&lt;-</span> largest_new_housing_CBSA<span class="sc">$</span>total_units</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The CBSA that permitted the largest number of new housing units from 2010 to 2019 was <strong>Houston-Pasadena-The Woodlands, TX Metro Area</strong>, with a total of <strong>482,075</strong> units.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Question 2">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Filter data for Albuquerque, NM (CBSA 10740)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>albuquerque_housing <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">10740</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_new_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Identify the year(s) with the highest number of new housing units</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>albuquerque_peak_year <span class="ot">&lt;-</span> albuquerque_housing <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(total_new_units, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Helper variables for inline display</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>peak_year  <span class="ot">&lt;-</span> albuquerque_peak_year<span class="sc">$</span>year</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>peak_units <span class="ot">&lt;-</span> albuquerque_peak_year<span class="sc">$</span>total_new_units</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The year in which Albuquerque, NM (CBSA 10740) permitted the most new housing units was <strong>2021</strong>, with a total of <strong>4,021</strong> new units.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Question 3">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which state (not CBSA) had the highest average individual income in 2015?</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>cbsa_2015 <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, households), <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, population), <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income_cbsa =</span> household_income <span class="sc">*</span> households,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">substr</span>(<span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^[^,]*,"</span>, <span class="st">""</span>, NAME)), <span class="dv">1</span>, <span class="dv">2</span>)  </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>state_2015 <span class="ot">&lt;-</span> cbsa_2015 <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_total_income =</span> <span class="fu">sum</span>(total_income_cbsa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_population   =</span> <span class="fu">sum</span>(population,        <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income_2015 =</span> state_total_income <span class="sc">/</span> state_population,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income_2015))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>top_state <span class="ot">&lt;-</span> state_2015 <span class="sc">%&gt;%</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(avg_individual_income_2015, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>top_state_codes  <span class="ot">&lt;-</span> <span class="fu">paste</span>(top_state<span class="sc">$</span>state, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>top_state_income <span class="ot">&lt;-</span> top_state<span class="sc">$</span>avg_individual_income_2015[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The state(s) with the highest average individual income in 2015: <strong>DC</strong>, with <strong>$33,232.88</strong> per person.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Question 4">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country?</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># BLS winners by year for NAICS 5182 (Data scientists &amp; business analysts)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>winners_5182 <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>, <span class="fu">grepl</span>(<span class="st">"^C"</span>, FIPS)) <span class="sc">%&gt;%</span>     <span class="co"># keep CBSA-level rows only</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>)) <span class="sc">%&gt;%</span>            <span class="co"># normalize: e.g., C3562 -&gt; C35620</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(EMPLOYMENT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># NYC std id</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>nyc_std <span class="ot">&lt;-</span> <span class="st">"C35620"</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>nyc_last <span class="ot">&lt;-</span> winners_5182 <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(std_cbsa <span class="sc">==</span> nyc_std) <span class="sc">%&gt;%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(YEAR, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>nyc_year <span class="ot">&lt;-</span> nyc_last<span class="sc">$</span>YEAR</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>nyc_emp  <span class="ot">&lt;-</span> nyc_last<span class="sc">$</span>EMPLOYMENT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>NYC (CBSA 35620) most recently led the nation in NAICS 5182 in <strong>2015</strong>, with <strong>18,922</strong> employed.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Question 5">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question 5
</div>
</div>
<div class="callout-body-container callout-body">
<p>What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Build NAICS_table for NYC CBSA from WAGES (CBSA-level rows use FIPS like "C3562")</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>NAICS_table <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FIPS <span class="sc">==</span> <span class="st">"C3562"</span>) <span class="sc">%&gt;%</span>              <span class="co"># NYC CBSA</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(YEAR, INDUSTRY, TOTAL_WAGES, EMPLOYMENT)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Total wages in NYC by year (all industries)</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>total_wages_by_year <span class="ot">&lt;-</span> NAICS_table <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_wages_all =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Finance &amp; Insurance (NAICS 52*) wages by year</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>fin52_wages_by_year <span class="ot">&lt;-</span> NAICS_table <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">str_starts</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"52"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># sector 52 and its subcodes</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_wages_52 =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Fraction of total wages from NAICS 52 each year</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>fin52_share_by_year <span class="ot">&lt;-</span> fin52_wages_by_year <span class="sc">%&gt;%</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(total_wages_by_year, <span class="at">by =</span> <span class="st">"YEAR"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">fin52_share =</span> total_wages_52 <span class="sc">/</span> total_wages_all)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Peak year(s)</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>fin52_peak <span class="ot">&lt;-</span> fin52_share_by_year <span class="sc">%&gt;%</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(fin52_share, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper scalars for inline printing</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>peak_years <span class="ot">&lt;-</span> <span class="fu">paste</span>(fin52_peak<span class="sc">$</span>YEAR, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>peak_share <span class="ot">&lt;-</span> <span class="fu">percent</span>(fin52_peak<span class="sc">$</span>fin52_share[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fraction of total wages in the NYC CBSA earned in Finance &amp; Insurance (NAICS 52) peaked in <strong>2021</strong> at <strong>16%</strong>.</p>
</section>
<section id="initial-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="initial-visualizations">Initial Visualizations</h2>
<section id="monthly-rent-vs.-average-household-income-2009" class="level3">
<h3 class="anchored" data-anchor-id="monthly-rent-vs.-average-household-income-2009">Monthly Rent vs.&nbsp;Average Household Income (2009)</h3>
<p>This plot shows how monthly rent relates to average household income across CBSAs in 2009. A fitted trend helps reveal the overall association.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="total-employment-vs.-health-care-social-assistance-naics-62-over-time" class="level3">
<h3 class="anchored" data-anchor-id="total-employment-vs.-health-care-social-assistance-naics-62-over-time">Total Employment vs.&nbsp;Health Care &amp; Social Assistance (NAICS 62), Over Time</h3>
<p>This faceted scatter shows, for each year, how total employment relates to employment in NAICS 62 by CBSA. The linear trend per panel makes the year-to-year evolution visible.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep CBSA-level rows (FIPS starts with "C") and normalize to std_cbsa if needed</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>WAGES_named <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_starts</span>(FIPS, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Total employment by CBSA-year (all industries)</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>general_employment_cbsa <span class="ot">&lt;-</span> WAGES_named <span class="sc">|&gt;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_employment =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Health care &amp; social assistance (NAICS 62) employment by CBSA-year</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>health_employment_cbsa <span class="ot">&lt;-</span> WAGES_named <span class="sc">|&gt;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_employment_health =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the two</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>table_cbsa_employment <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>general_employment_cbsa, health_employment_cbsa,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>, <span class="st">"YEAR"</span>)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(table_cbsa_employment,</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> total_employment, <span class="at">y =</span> total_employment_health)) <span class="sc">+</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>())) <span class="sc">+</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="at">title   =</span> <span class="st">"Health Care &amp; Social Assistance vs. Total Employment Across CBSAs (2009–2023)"</span>,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="at">x       =</span> <span class="st">"Total Employment (All Industries)"</span>,</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="at">y       =</span> <span class="st">"Employment in Health Care &amp; Social Assistance (NAICS 62)"</span>,</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="st">"Source: BLS QCEW Annual Averages"</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/viz-health-vs-total-over-time-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evolution-of-average-household-size-over-time" class="level3">
<h3 class="anchored" data-anchor-id="evolution-of-average-household-size-over-time">Evolution of Average Household Size Over Time</h3>
<p>This line plot shows average household size by CBSA over time, with NYC (35620) and Los Angeles (31080) highlighted for emphasis.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute average household size by CBSA-year</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>avg_household_size <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_household_size =</span> population <span class="sc">/</span> households)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>nyc_la_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">35620</span>, <span class="dv">31080</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_household_size,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_household_size, <span class="at">group =</span> GEOID, <span class="at">color =</span> NAME)) <span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">gghighlight</span>(GEOID <span class="sc">%in%</span> nyc_la_ids, <span class="at">use_direct_label =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="at">title    =</span> <span class="st">"Evolution of Average Household Size (2009–2023)"</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"New York (35620) and Los Angeles (31080) highlighted"</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="at">x        =</span> <span class="st">"Year"</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="at">y        =</span> <span class="st">"Average Household Size"</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="at">color    =</span> <span class="st">"CBSA"</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="at">caption  =</span> <span class="st">"Source: U.S. Census Bureau, ACS 1-Year Estimates"</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2009</span>, <span class="dv">2023</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="at">plot.title      =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="at">plot.subtitle   =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>,  <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title      =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/viz-avg-household-size-over-time-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rent-burden-metric-standardization" class="level3">
<h3 class="anchored" data-anchor-id="rent-burden-metric-standardization">Rent Burden Metric &amp; Standardization</h3>
<p>In this step: 1. We construct a rent-to-income metric per CBSA/year; 2. Standardize it two ways—by-year min–max (0–100) to compare metros within the same year, and global scales (long-term baseline = 100 and global min–max 0–100) to compare across years; 3. Identify CBSAs with highest/lowest rent burden over the period. We also show an example table for a specific CBSA.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Construct rent burden: % income spent on rent</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rent_to_income =</span> <span class="dv">100</span> <span class="sc">*</span> monthly_rent <span class="sc">/</span> (household_income <span class="sc">/</span> <span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, rent_to_income)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) By-year min–max standardization (0–100), guarded for zero-range years</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>min_max_year <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="at">.min =</span> <span class="fu">min</span>(rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="at">.max =</span> <span class="fu">max</span>(rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="at">rti_0_100_byyear =</span> <span class="fu">if_else</span>(</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>.max <span class="sc">&gt;</span> .min,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> (rent_to_income <span class="sc">-</span> .min) <span class="sc">/</span> (.max <span class="sc">-</span> .min),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="cn">NA_real_</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, rent_to_income, rti_0_100_byyear)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Example CBSA table (Miami–Fort Lauderdale–West Palm Beach, FL -&gt; 33100)</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>min_max_33100 <span class="ot">&lt;-</span> min_max_year <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">"33100"</span>)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> min_max_33100 <span class="sc">%&gt;%</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, rent_to_income, rti_0_100_byyear) <span class="sc">%&gt;%</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rent_to_income_frac =</span> rent_to_income <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>rent_to_income) <span class="sc">%&gt;%</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Name</span><span class="st">`</span><span class="ot">=</span> NAME,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Year</span><span class="st">`</span><span class="ot">=</span> year,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Rent-to-Income</span><span class="st">`</span> <span class="ot">=</span> rent_to_income_frac,</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Rent Burden Index (0–100)</span><span class="st">`</span> <span class="ot">=</span> rti_0_100_byyear</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>tbl,</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">formatPercentage</span>(<span class="at">columns =</span> <span class="st">"Rent-to-Income"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="st">"Rent Burden Index (0–100)"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-28c0a745634efd8f809b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-28c0a745634efd8f809b">{"x":{"filter":"none","vertical":false,"data":[[33100,33100,33100,33100,33100,33100,33100,33100,33100,33100,33100,33100,33100,33100],["Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area"],[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2021,2022,2023],[71.98782627343982,69.79399808318124,78.23773009924687,62.75434522506877,72.49938616963898,62.70519634149646,81.6208925168058,80.91164529024491,77.71753131215824,63.92796196461679,85.55395065042505,89.19162677081187,79.29720140473066,94.27504305100058],[0.2812867278979672,0.2812665373081672,0.2848899949347017,0.2811696107014234,0.2862863715758531,0.2837921499030088,0.2873852619892547,0.2918110665472528,0.2909144499299978,0.2897315722198551,0.2869257245473138,0.2856426489485066,0.2902965987932569,0.3011367361120216]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA<\/th>\n      <th>Name<\/th>\n      <th>Year<\/th>\n      <th>Rent Burden Index (0–100)<\/th>\n      <th>Rent-to-Income<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"pageLength":10,"columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4]},{"name":"CBSA","targets":0},{"name":"Name","targets":1},{"name":"Year","targets":2},{"name":"Rent Burden Index (0–100)","targets":3},{"name":"Rent-to-Income","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="interpretation-of-rent-burden-trends-miamifort-lauderdale-cbsa-33100" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-of-rent-burden-trends-miamifort-lauderdale-cbsa-33100">Interpretation of Rent Burden Trends (Miami–Fort Lauderdale CBSA 33100)</h2>
<p>Between 2009 and 2018, the rent-to-income ratio in the Miami–Fort Lauderdale metropolitan area remained relatively stable, ranging from 28% to 29%, indicating that households consistently spent nearly one-third of their income on rent.</p>
<p>However, the Rent Burden Index (0–100) fluctuated considerably, reflecting changes relative to other CBSAs each year.</p>
<p>The index was around 72 in 2009, dipped to 62 in 2012 and 2014, and reached its peak of 81.6 in 2015, suggesting that Miami’s rent burden was among the highest in the country that year.</p>
<p>The moderate decrease afterward (to ~64 by 2018) indicates slight improvement, possibly due to income growth or slower rent increases.</p>
<p>Overall, Miami remained a high-rent-burden metro area throughout the decade, with minor year-to-year shifts influenced more by national relative comparisons than by large local changes in the rent-to-income ratio itself. ## Global scales (long-term baseline = 100; global min–max 0–100)</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Long-term national stats (across all CBSAs/years)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>nat_longterm_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>nat_longterm_sd   <span class="ot">&lt;-</span> <span class="fu">sd</span>(rent_burden<span class="sc">$</span>rent_to_income,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>nat_min           <span class="ot">&lt;-</span> <span class="fu">min</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>nat_max           <span class="ot">&lt;-</span> <span class="fu">max</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline 100 at long-term national average</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rti_index_longterm100 =</span> <span class="dv">100</span> <span class="sc">*</span> rent_to_income <span class="sc">/</span> nat_longterm_mean)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Global min–max 0–100 across all years</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rti_minmax_0_100 =</span> <span class="dv">100</span> <span class="sc">*</span> (rent_to_income <span class="sc">-</span> nat_min) <span class="sc">/</span> (nat_max <span class="sc">-</span> nat_min))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="topbottom-cbsas-on-global-index-result-tables" class="level2">
<h2 class="anchored" data-anchor-id="topbottom-cbsas-on-global-index-result-tables">Top/Bottom CBSAs on global index + result tables</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extremes by CBSA</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>cbsa_max <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">max_idx =</span> <span class="fu">max</span>(rti_minmax_0_100, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>cbsa_min <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">min_idx =</span> <span class="fu">min</span>(rti_minmax_0_100, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>top5_overall    <span class="ot">&lt;-</span> cbsa_max <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(max_idx, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>bottom5_overall <span class="ot">&lt;-</span> cbsa_min <span class="sc">%&gt;%</span> <span class="fu">slice_min</span>(min_idx, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional list to highlight in plots</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>to_highlight <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>top5_overall <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, NAME),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>bottom5_overall <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, NAME)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display tables</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>top5_overall <span class="sc">%&gt;%</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Name</span><span class="st">`</span><span class="ot">=</span> NAME,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Max Rent Burden Index Long Years (0–100)</span><span class="st">`</span> <span class="ot">=</span> max_idx</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> DT<span class="sc">::</span><span class="fu">formatRound</span>(<span class="st">"Max Rent Burden Index Long Years (0–100)"</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-19a4387cdac1afbb28df" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-19a4387cdac1afbb28df">{"x":{"filter":"none","vertical":false,"data":[[32420,41900,25020,41900,17620],["Mayagüez, PR Metro Area","San Germán, PR Metro Area","Guayama, PR Metro Area","San Germ?n-Cabo Rojo, PR Metro Area","Coamo, PR Micro Area"],[100,96.31432457931948,95.14672323285789,86.52927954623368,84.88896341678166]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA<\/th>\n      <th>Name<\/th>\n      <th>Max Rent Burden Index Long Years (0–100)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"pageLength":10,"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2]},{"name":"CBSA","targets":0},{"name":"Name","targets":1},{"name":"Max Rent Burden Index Long Years (0–100)","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>bottom5_overall <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Name</span><span class="st">`</span><span class="ot">=</span> NAME,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Min Rent Burden Index Long Years (0–100)</span><span class="st">`</span> <span class="ot">=</span> min_idx</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> DT<span class="sc">::</span><span class="fu">formatRound</span>(<span class="st">"Min Rent Burden Index Long Years (0–100)"</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c9a911406090898898a7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c9a911406090898898a7">{"x":{"filter":"none","vertical":false,"data":[[13900,27620,27600,29060,24260],["Bismarck, ND Metro Area","Jefferson City, MO Metro Area","Jefferson, GA Micro Area","Laconia, NH Micro Area","Grand Island, NE Metro Area"],[0,1.154800003742894,1.232654166788477,1.643812142406742,2.019340464743699]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA<\/th>\n      <th>Name<\/th>\n      <th>Min Rent Burden Index Long Years (0–100)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"info":false,"pageLength":10,"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2]},{"name":"CBSA","targets":0},{"name":"Name","targets":1},{"name":"Min Rent Burden Index Long Years (0–100)","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
<section id="interpretation-national-extremes" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-national-extremes">Interpretation — National Extremes</h3>
<ul>
<li><p>Highest burdens: Puerto Rican metro/micro areas dominate the top-5, with indices up to ~100, indicating households devote a much larger share of income to rent than the U.S. long-term average. Persistent high burdens likely reflect income constraints, disaster recovery pressures, and tight housing markets.</p></li>
<li><p>Lowest burdens: Smaller inland CBSAs (e.g., Bismarck, ND; Jefferson City, MO) show indices near 0–2, meaning rent is a small share of income. These regions tend to have moderate rents and incomes sufficient to keep burdens low.</p></li>
</ul>
</section>
</section>
<section id="visualizing-yimby-patterns" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-yimby-patterns">Visualizing “YIMBY” Patterns</h2>
<section id="visualization-a-housing-growth-vs.-change-in-rent-burden-cbsa-level" class="level3">
<h3 class="anchored" data-anchor-id="visualization-a-housing-growth-vs.-change-in-rent-burden-cbsa-level">Visualization A — Housing growth vs.&nbsp;change in rent burden (CBSA-level)</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/t6-viz-scatter-yimby-1.png" class="img-fluid figure-img" width="720"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-visualization-a." class="level3">
<h3 class="anchored" data-anchor-id="interpretation-visualization-a.">Interpretation (Visualization A).</h3>
<p>This scatter shows how housing supply growth relates to affordability changes. CBSAs in the lower-right quadrant combine above-average housing growth with declining rent burden—the hallmark of a YIMBY outcome. Your labeled candidates (in green) illustrate cases where stronger construction coincided with improved affordability, supporting the idea that more building can help stabilize rents even as demand rises. Areas in the upper-right quadrant still built a lot but saw rent burden increase, implying supply didn’t fully keep pace with demand.</p>
</section>
</section>
<section id="visualization-b-rent-burden-solid-vs.-housing-growth-index-dashed-over-time" class="level2">
<h2 class="anchored" data-anchor-id="visualization-b-rent-burden-solid-vs.-housing-growth-index-dashed-over-time">Visualization B — Rent burden (solid) vs.&nbsp;housing growth index (dashed) over time</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/t6-viz-timeseries-highlight-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-visualization-b." class="level3">
<h3 class="anchored" data-anchor-id="interpretation-visualization-b.">Interpretation (Visualization B).</h3>
<p>This time-series overlay lets you track whether rent burden trends (solid) improve as housing growth (dashed) strengthens. Highlighted CBSAs show a declining rent-to-income trend while the housing growth index rises, meeting key YIMBY criteria. Where the dashed line rises without a corresponding fall in the solid line, supply likely lagged demand (or income growth lagged), so affordability didn’t improve.</p>
</section>
</section>
<section id="policy-brief-the-federal-yimby-housing-acceleration-act" class="level2">
<h2 class="anchored" data-anchor-id="policy-brief-the-federal-yimby-housing-acceleration-act">🏙️ Policy Brief: The Federal YIMBY Housing Acceleration Act</h2>
<section id="encouraging-local-growth-through-smarter-federal-incentives" class="level3">
<h3 class="anchored" data-anchor-id="encouraging-local-growth-through-smarter-federal-incentives"><em>Encouraging Local Growth Through Smarter Federal Incentives</em></h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Objective:</strong><br>
Promote housing affordability and sustainable development by incentivizing municipalities that successfully reduce rent burden while increasing housing supply.</p>
</div>
</div>
</section>
<section id="key-analytical-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-analytical-findings">Key Analytical Findings</h3>
<p>Our analysis of U.S. <strong>Census Bureau (ACS)</strong> and <strong>Bureau of Labor Statistics (BLS)</strong> data reveals a clear divide between YIMBY success stories and NIMBY-constrained cities.</p>
<ul>
<li><strong>YIMBY Success Cities</strong> — <em>Austin (TX), Raleigh (NC), Boise (ID)</em>
<ul>
<li>Experienced <strong>high housing growth</strong>, <strong>declining rent burdens</strong>, and <strong>steady population gains</strong>.<br>
</li>
<li>These metros demonstrate that balanced housing supply stabilizes rent levels even amid rapid growth.</li>
</ul></li>
</ul>
<p>These metros demonstrate that balanced housing supply stabilizes rent levels even amid rapid growth.</p>
<ul>
<li><strong>NIMBY Cities</strong> — <em>Los Angeles (CA), Miami (FL)</em>
<ul>
<li>Display <strong>persistently high rent burdens</strong> and <strong>limited new housing development</strong>, signaling affordability stress and restrictive zoning barriers.</li>
</ul></li>
</ul>
</section>
<section id="proposed-congressional-sponsors" class="level3">
<h3 class="anchored" data-anchor-id="proposed-congressional-sponsors">Proposed Congressional Sponsors</h3>
<ul>
<li><strong>Primary Sponsor:</strong> Representative from <strong>Austin, TX</strong> — a proven <em>YIMBY leader</em> that balanced affordability with growth through streamlined zoning and development incentives.<br>
</li>
<li><strong>Co-Sponsor:</strong> Representative from <strong>Los Angeles, CA</strong> — a <em>high-cost, low-supply</em> metro that stands to gain from national housing reform.</li>
</ul>
<p>Together, they embody the coalition needed to address America’s affordability crisis.</p>
</section>
<section id="strategic-labor-and-industry-partnerships" class="level3">
<h3 class="anchored" data-anchor-id="strategic-labor-and-industry-partnerships">Strategic Labor and Industry Partnerships</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Sector</th>
<th style="text-align: left;">Why It Matters</th>
<th style="text-align: left;">Projected Impact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Construction (NAICS 23)</strong></td>
<td style="text-align: left;">Increased development creates jobs and supports union contractors.</td>
<td style="text-align: left;">Sustained rise in housing starts adds thousands of jobs nationwide.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Education &amp; Public Safety (NAICS 61 &amp; 92)</strong></td>
<td style="text-align: left;">High rents limit where teachers, firefighters, and police can live.</td>
<td style="text-align: left;">Lower rent burdens allow essential workers to reside near workplaces.</td>
</tr>
</tbody>
</table>
</section>
<section id="recommended-evaluation-metrics" class="level3">
<h3 class="anchored" data-anchor-id="recommended-evaluation-metrics">Recommended Evaluation Metrics</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Rent Burden Index (RBI)</strong></td>
<td style="text-align: left;">Share of income spent on rent, standardized to a common 0–100 scale across metros.</td>
<td style="text-align: left;">Higher values = higher cost pressure; falling values over time signal improved affordability.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Housing Growth Rate (HGR)</strong></td>
<td style="text-align: left;">New housing units permitted relative to population, standardized to 0–100.</td>
<td style="text-align: left;">Higher values = stronger housing expansion; sustained increases indicate supply responsiveness.</td>
</tr>
</tbody>
</table>
<p>A <em>“High-YIMBY” city</em> scores <strong>low RBI</strong> and <strong>high HGR</strong> over time, qualifying for federal funding and recognition.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The analysis conducted through this project highlights a clear and data-driven story: <strong>cities that embrace YIMBY (“Yes In My Backyard”) housing policies thrive</strong>—they sustain population growth, reduce rent burdens, and maintain balanced, inclusive urban development.</p>
<p>By comparing rent burden and housing growth metrics across Core-Based Statistical Areas (CBSAs), we identified metros like <strong>Austin, TX</strong>, <strong>Raleigh, NC</strong>, and <strong>Boise, ID</strong> as examples of YIMBY success. These regions demonstrate how proactive zoning reform, faster permitting, and public–private coordination can yield tangible results in affordability and livability.</p>
<p>Conversely, high-cost metros such as <strong>Los Angeles, CA</strong> and <strong>Miami, FL</strong> face growing affordability challenges. Their stagnant housing growth and persistently high rent burdens underscore the urgent need for <strong>federal intervention</strong> and incentive alignment.</p>
<p>The proposed <strong>Federal YIMBY Housing Acceleration Act</strong> directly addresses these disparities. It empowers municipalities to expand housing supply, reduce rent pressure, and improve quality of life — all while creating high-quality jobs in construction, real estate, and essential public sectors.</p>
<p><strong>Key takeaway:</strong><br>
&gt; Sustainable growth is not only a matter of economics but of equity. By rewarding municipalities that make measurable progress on housing growth and rent burden reduction, Congress can create a new pathway to affordability for millions of Americans.</p>
<p>In summary, this policy brief demonstrates that YIMBY principles—when supported by clear data and effective incentives—can make housing more affordable, communities more inclusive, and local economies more resilient.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Cristinam01\.github\.io\/STA9750-2025-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb21" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Making Backyards Affordable for All"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Maria Cristina Moreno"</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>This project explores the dynamics between housing growth and rent burden across U.S. metropolitan areas using data from the U.S. Census Bureau (ACS) and Bureau of Labor Statistics (BLS). By combining demographic, income, and construction permit data, the analysis investigates how new housing development influences affordability and population trends over time. Through the construction of standardized indices for rent burden and housing growth, as well as the creation of a composite measure, the project identifies cities exhibiting “YIMBY” (Yes In My Backyard) characteristics — regions where increased housing supply has coincided with reduced rent pressures and sustained population growth. Visualizations and data transformations in R (tidyverse, ggplot2, tidycensus) provide a data-driven perspective on housing policy outcomes and urban development patterns.</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section Overview</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>In this section:</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Construct rent burden and housing growth metrics from ACS and BLS data.</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Standardize both indicators to a 0–100 scale for comparability.</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Visualize trends and relationships between rent burden, housing growth, and population change.</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Identify CBSAs showing “YIMBY” outcomes — high initial rent burden, declining rents, population growth, and strong housing development.</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Interpret results to understand how housing supply influences affordability across U.S. cities.</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Develop a concise **policy brief** summarizing the key findings, highlighting data-driven evidence on housing growth and affordability. The brief serves as an “elevator pitch” for proposed legislation supporting sustainable housing development, with hypothetical congressional sponsors representing major urban centers such as Houston, TX and New York, NY.</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyverse)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(glue)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidycensus)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>      tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>INCOME</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>RENT</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>POPULATION</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a>PERMITS</span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a><span class="co"># NAICS data schema</span></span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-152"><a href="#cb21-152" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb21-153"><a href="#cb21-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_perform</span>()</span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb21-166"><a href="#cb21-166" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-167"><a href="#cb21-167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-170"><a href="#cb21-170" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb21-171"><a href="#cb21-171" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a>             <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a>             <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a>             level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb21-191"><a href="#cb21-191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-192"><a href="#cb21-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES</span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a><span class="co">#BLS Quarterly Census of Employment and Wages</span></span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb21-199"><a href="#cb21-199" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb21-200"><a href="#cb21-200" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a>      fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a>        <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a>               <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(area_fips, </span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a>               industry_code, </span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a>               annual_avg_emplvl, </span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a>               total_annual_wages, </span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a>               YEAR) <span class="sc">|&gt;</span></span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a>               <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a>               <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a>               <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a>               <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>industry_code, </span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb21-248"><a href="#cb21-248" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-249"><a href="#cb21-249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a>  ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a>  ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a>  YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a>         <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb21-259"><a href="#cb21-259" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-260"><a href="#cb21-260" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a>  ALL_DATA</span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a>WAGES </span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>()</span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Acquisition</span></span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a>This project uses data primarily from the U.S. Census Bureau and the Bureau of Labor Statistics (BLS). The Census Bureau conducts multiple ongoing surveys in addition to the decennial census, the most important being the American Community Survey (ACS), which continuously tracks household, demographic, and economic indicators across the country.</span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a>To simplify access and ensure consistency, data was downloaded and cleaned using the tidycensus R package. All analyses are performed at the Core-Based Statistical Area (CBSA) level — geographic units that represent metropolitan or micropolitan regions surrounding a central urban core. For example, the New York-Newark-Jersey City, NY-NJ CBSA encompasses the wider New York metropolitan region.</span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a>Additionally, data from the Bureau of Labor Statistics (BLS) was integrated to provide employment and income context using the North American Industry Classification System (NAICS) codes. These combined datasets enable a comprehensive view of how housing, income, and population dynamics interact across urban regions.</span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a><span class="al">![Housing Price](housing_price.jpeg)</span>{width=100% fig-align="center" fig-alt="Housing Price"}</span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Integration and Initial Exploration</span></span>
<span id="cb21-280"><a href="#cb21-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-281"><a href="#cb21-281" aria-hidden="true" tabindex="-1"></a>Now that all datasets have been successfully downloaded, cleaned, and merged, this step focuses on performing an initial analysis to become familiar with the structure, variables, and relationships within the data.</span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a>The goal here is not to produce final insights, but rather to build fluency with the tables and ensure a solid understanding of what information is available.</span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Question 1"}</span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a>Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q1-largest-cbsa-2010-2019</span></span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-300"><a href="#cb21-300" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb21-301"><a href="#cb21-301" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Aggregate permits for 2010–2019 by CBSA</span></span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-305"><a href="#cb21-305" aria-hidden="true" tabindex="-1"></a>permits_agg <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb21-306"><a href="#cb21-306" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">between</span>(year, <span class="dv">2010</span>, <span class="dv">2019</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(CBSA) <span class="sc">|&gt;</span></span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Lookup table: latest CBSA name per GEOID (avoids duplicates over time)</span></span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a>cbsa_lookup <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(GEOID, year) <span class="sc">|&gt;</span></span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb21-315"><a href="#cb21-315" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-316"><a href="#cb21-316" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME)</span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Attach name and select the top CBSA</span></span>
<span id="cb21-320"><a href="#cb21-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-321"><a href="#cb21-321" aria-hidden="true" tabindex="-1"></a>largest_new_housing_CBSA <span class="ot">&lt;-</span> permits_agg <span class="sc">|&gt;</span></span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(cbsa_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span> <span class="ot">=</span> <span class="st">"GEOID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">coalesce</span>(NAME, <span class="fu">as.character</span>(CBSA))) <span class="sc">|&gt;</span></span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(total_units, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Helper scalars for inline printing</span></span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a>top_name  <span class="ot">&lt;-</span> largest_new_housing_CBSA<span class="sc">$</span>NAME</span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a>top_units <span class="ot">&lt;-</span> largest_new_housing_CBSA<span class="sc">$</span>total_units</span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a>The CBSA that permitted the largest number of new housing units from 2010 to 2019 was **`r top_name`**, with a total of **`r comma(top_units)`** units.</span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Question 2"}</span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a>In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q2-albuquerque-max-year</span></span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Filter data for Albuquerque, NM (CBSA 10740)</span></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-352"><a href="#cb21-352" aria-hidden="true" tabindex="-1"></a>albuquerque_housing <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb21-353"><a href="#cb21-353" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="dv">10740</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_new_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Identify the year(s) with the highest number of new housing units</span></span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-359"><a href="#cb21-359" aria-hidden="true" tabindex="-1"></a>albuquerque_peak_year <span class="ot">&lt;-</span> albuquerque_housing <span class="sc">|&gt;</span></span>
<span id="cb21-360"><a href="#cb21-360" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(total_new_units, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Helper variables for inline display</span></span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a>peak_year  <span class="ot">&lt;-</span> albuquerque_peak_year<span class="sc">$</span>year</span>
<span id="cb21-365"><a href="#cb21-365" aria-hidden="true" tabindex="-1"></a>peak_units <span class="ot">&lt;-</span> albuquerque_peak_year<span class="sc">$</span>total_new_units</span>
<span id="cb21-366"><a href="#cb21-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a>The year in which Albuquerque, NM (CBSA 10740) permitted the most new housing units was **`r peak_year`**, with a total of **`r scales::comma(peak_units)`** new units.</span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Question 3"}</span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-372"><a href="#cb21-372" aria-hidden="true" tabindex="-1"></a>Which state (not CBSA) had the highest average individual income in 2015?</span>
<span id="cb21-373"><a href="#cb21-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-375"><a href="#cb21-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q3-highest-state-avg-ind-income-2015</span></span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a>cbsa_2015 <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb21-393"><a href="#cb21-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, households), <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-394"><a href="#cb21-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, population), <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income_cbsa =</span> household_income <span class="sc">*</span> households,</span>
<span id="cb21-397"><a href="#cb21-397" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">substr</span>(<span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"^[^,]*,"</span>, <span class="st">""</span>, NAME)), <span class="dv">1</span>, <span class="dv">2</span>)  </span>
<span id="cb21-398"><a href="#cb21-398" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a>state_2015 <span class="ot">&lt;-</span> cbsa_2015 <span class="sc">%&gt;%</span></span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_total_income =</span> <span class="fu">sum</span>(total_income_cbsa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_population   =</span> <span class="fu">sum</span>(population,        <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income_2015 =</span> state_total_income <span class="sc">/</span> state_population,</span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income_2015))</span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a>top_state <span class="ot">&lt;-</span> state_2015 <span class="sc">%&gt;%</span></span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(avg_individual_income_2015, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a>top_state_codes  <span class="ot">&lt;-</span> <span class="fu">paste</span>(top_state<span class="sc">$</span>state, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a>top_state_income <span class="ot">&lt;-</span> top_state<span class="sc">$</span>avg_individual_income_2015[<span class="dv">1</span>]</span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a>The state(s) with the highest average individual income in 2015: **`r top_state_codes`**, with **`r dollar(top_state_income)`** per person.</span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Question 4"}</span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a>Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country?</span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q4-nyc-most-data-scientists-last-year</span></span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-435"><a href="#cb21-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-436"><a href="#cb21-436" aria-hidden="true" tabindex="-1"></a><span class="co"># BLS winners by year for NAICS 5182 (Data scientists &amp; business analysts)</span></span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a>winners_5182 <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>, <span class="fu">grepl</span>(<span class="st">"^C"</span>, FIPS)) <span class="sc">%&gt;%</span>     <span class="co"># keep CBSA-level rows only</span></span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>)) <span class="sc">%&gt;%</span>            <span class="co"># normalize: e.g., C3562 -&gt; C35620</span></span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(EMPLOYMENT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>()</span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a><span class="co"># NYC std id</span></span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a>nyc_std <span class="ot">&lt;-</span> <span class="st">"C35620"</span></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a>nyc_last <span class="ot">&lt;-</span> winners_5182 <span class="sc">%&gt;%</span></span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(std_cbsa <span class="sc">==</span> nyc_std) <span class="sc">%&gt;%</span></span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(YEAR, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a>nyc_year <span class="ot">&lt;-</span> nyc_last<span class="sc">$</span>YEAR</span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a>nyc_emp  <span class="ot">&lt;-</span> nyc_last<span class="sc">$</span>EMPLOYMENT</span>
<span id="cb21-455"><a href="#cb21-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a>NYC (CBSA 35620) most recently led the nation in NAICS 5182 in **`r nyc_year`**, with **`r comma(nyc_emp)`** employed.</span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Question 5"}</span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a>What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-465"><a href="#cb21-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-466"><a href="#cb21-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: q5-nyc-finance-insurance-share</span></span>
<span id="cb21-467"><a href="#cb21-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-468"><a href="#cb21-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-469"><a href="#cb21-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-470"><a href="#cb21-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-471"><a href="#cb21-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-472"><a href="#cb21-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-473"><a href="#cb21-473" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-474"><a href="#cb21-474" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb21-475"><a href="#cb21-475" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-476"><a href="#cb21-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-477"><a href="#cb21-477" aria-hidden="true" tabindex="-1"></a><span class="co"># Build NAICS_table for NYC CBSA from WAGES (CBSA-level rows use FIPS like "C3562")</span></span>
<span id="cb21-478"><a href="#cb21-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-479"><a href="#cb21-479" aria-hidden="true" tabindex="-1"></a>NAICS_table <span class="ot">&lt;-</span> WAGES <span class="sc">%&gt;%</span></span>
<span id="cb21-480"><a href="#cb21-480" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(FIPS <span class="sc">==</span> <span class="st">"C3562"</span>) <span class="sc">%&gt;%</span>              <span class="co"># NYC CBSA</span></span>
<span id="cb21-481"><a href="#cb21-481" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(YEAR, INDUSTRY, TOTAL_WAGES, EMPLOYMENT)</span>
<span id="cb21-482"><a href="#cb21-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-483"><a href="#cb21-483" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Total wages in NYC by year (all industries)</span></span>
<span id="cb21-484"><a href="#cb21-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-485"><a href="#cb21-485" aria-hidden="true" tabindex="-1"></a>total_wages_by_year <span class="ot">&lt;-</span> NAICS_table <span class="sc">%&gt;%</span></span>
<span id="cb21-486"><a href="#cb21-486" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb21-487"><a href="#cb21-487" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_wages_all =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-488"><a href="#cb21-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-489"><a href="#cb21-489" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Finance &amp; Insurance (NAICS 52*) wages by year</span></span>
<span id="cb21-490"><a href="#cb21-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-491"><a href="#cb21-491" aria-hidden="true" tabindex="-1"></a>fin52_wages_by_year <span class="ot">&lt;-</span> NAICS_table <span class="sc">%&gt;%</span></span>
<span id="cb21-492"><a href="#cb21-492" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">str_starts</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"52"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># sector 52 and its subcodes</span></span>
<span id="cb21-493"><a href="#cb21-493" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span></span>
<span id="cb21-494"><a href="#cb21-494" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">total_wages_52 =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-495"><a href="#cb21-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-496"><a href="#cb21-496" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Fraction of total wages from NAICS 52 each year</span></span>
<span id="cb21-497"><a href="#cb21-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-498"><a href="#cb21-498" aria-hidden="true" tabindex="-1"></a>fin52_share_by_year <span class="ot">&lt;-</span> fin52_wages_by_year <span class="sc">%&gt;%</span></span>
<span id="cb21-499"><a href="#cb21-499" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(total_wages_by_year, <span class="at">by =</span> <span class="st">"YEAR"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-500"><a href="#cb21-500" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">fin52_share =</span> total_wages_52 <span class="sc">/</span> total_wages_all)</span>
<span id="cb21-501"><a href="#cb21-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-502"><a href="#cb21-502" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Peak year(s)</span></span>
<span id="cb21-503"><a href="#cb21-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-504"><a href="#cb21-504" aria-hidden="true" tabindex="-1"></a>fin52_peak <span class="ot">&lt;-</span> fin52_share_by_year <span class="sc">%&gt;%</span></span>
<span id="cb21-505"><a href="#cb21-505" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(fin52_share, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-506"><a href="#cb21-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-507"><a href="#cb21-507" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper scalars for inline printing</span></span>
<span id="cb21-508"><a href="#cb21-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-509"><a href="#cb21-509" aria-hidden="true" tabindex="-1"></a>peak_years <span class="ot">&lt;-</span> <span class="fu">paste</span>(fin52_peak<span class="sc">$</span>YEAR, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb21-510"><a href="#cb21-510" aria-hidden="true" tabindex="-1"></a>peak_share <span class="ot">&lt;-</span> <span class="fu">percent</span>(fin52_peak<span class="sc">$</span>fin52_share[<span class="dv">1</span>])</span>
<span id="cb21-511"><a href="#cb21-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-512"><a href="#cb21-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-513"><a href="#cb21-513" aria-hidden="true" tabindex="-1"></a>Fraction of total wages in the NYC CBSA earned in Finance &amp; Insurance (NAICS 52) peaked in **`r peak_years`** at **`r peak_share`**.</span>
<span id="cb21-514"><a href="#cb21-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-515"><a href="#cb21-515" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial Visualizations</span></span>
<span id="cb21-516"><a href="#cb21-516" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monthly Rent vs. Average Household Income (2009)</span></span>
<span id="cb21-517"><a href="#cb21-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-518"><a href="#cb21-518" aria-hidden="true" tabindex="-1"></a>This plot shows how monthly rent relates to average household income across CBSAs in 2009. A fitted trend helps reveal the overall association.</span>
<span id="cb21-521"><a href="#cb21-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-522"><a href="#cb21-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-rent-vs-income-2009</span></span>
<span id="cb21-523"><a href="#cb21-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-524"><a href="#cb21-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-525"><a href="#cb21-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-526"><a href="#cb21-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb21-527"><a href="#cb21-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb21-528"><a href="#cb21-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-529"><a href="#cb21-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-530"><a href="#cb21-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-531"><a href="#cb21-531" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-532"><a href="#cb21-532" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-533"><a href="#cb21-533" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-534"><a href="#cb21-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-535"><a href="#cb21-535" aria-hidden="true" tabindex="-1"></a><span class="co"># Join ACS tables and filter to 2009</span></span>
<span id="cb21-536"><a href="#cb21-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-537"><a href="#cb21-537" aria-hidden="true" tabindex="-1"></a>mr_ahi <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(INCOME, RENT, dplyr<span class="sc">::</span><span class="fu">join_by</span>(GEOID, year)) <span class="sc">|&gt;</span></span>
<span id="cb21-538"><a href="#cb21-538" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>)</span>
<span id="cb21-539"><a href="#cb21-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-540"><a href="#cb21-540" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mr_ahi, <span class="fu">aes</span>(<span class="at">x =</span> monthly_rent, <span class="at">y =</span> household_income)) <span class="sc">+</span></span>
<span id="cb21-541"><a href="#cb21-541" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb21-542"><a href="#cb21-542" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-543"><a href="#cb21-543" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb21-544"><a href="#cb21-544" aria-hidden="true" tabindex="-1"></a><span class="at">title    =</span> <span class="st">"Relationship Between Monthly Rent and </span><span class="sc">\n</span><span class="st"> Average Household Income (2009)"</span>,</span>
<span id="cb21-545"><a href="#cb21-545" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"Each point represents a CBSA"</span>,</span>
<span id="cb21-546"><a href="#cb21-546" aria-hidden="true" tabindex="-1"></a><span class="at">x        =</span> <span class="st">"Monthly Rent (US Dollars)"</span>,</span>
<span id="cb21-547"><a href="#cb21-547" aria-hidden="true" tabindex="-1"></a><span class="at">y        =</span> <span class="st">"Average Household Income (US Dollars)"</span>,</span>
<span id="cb21-548"><a href="#cb21-548" aria-hidden="true" tabindex="-1"></a><span class="at">caption  =</span> <span class="st">"Source: U.S. Census Bureau, ACS 1-Year Estimates (2009)"</span></span>
<span id="cb21-549"><a href="#cb21-549" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb21-550"><a href="#cb21-550" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb21-551"><a href="#cb21-551" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb21-552"><a href="#cb21-552" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb21-553"><a href="#cb21-553" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb21-554"><a href="#cb21-554" aria-hidden="true" tabindex="-1"></a><span class="at">plot.title   =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-555"><a href="#cb21-555" aria-hidden="true" tabindex="-1"></a><span class="at">plot.subtitle=</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>,  <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-556"><a href="#cb21-556" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title   =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb21-557"><a href="#cb21-557" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-558"><a href="#cb21-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-559"><a href="#cb21-559" aria-hidden="true" tabindex="-1"></a><span class="fu">### Total Employment vs. Health Care &amp; Social Assistance (NAICS 62), Over Time</span></span>
<span id="cb21-560"><a href="#cb21-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-561"><a href="#cb21-561" aria-hidden="true" tabindex="-1"></a>This faceted scatter shows, for each year, how total employment relates to employment in NAICS 62 by CBSA. The linear trend per panel makes the year-to-year evolution visible.</span>
<span id="cb21-564"><a href="#cb21-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-565"><a href="#cb21-565" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-health-vs-total-over-time</span></span>
<span id="cb21-566"><a href="#cb21-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-567"><a href="#cb21-567" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-568"><a href="#cb21-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-569"><a href="#cb21-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb21-570"><a href="#cb21-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb21-571"><a href="#cb21-571" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-572"><a href="#cb21-572" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-573"><a href="#cb21-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-574"><a href="#cb21-574" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-575"><a href="#cb21-575" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-576"><a href="#cb21-576" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-577"><a href="#cb21-577" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb21-578"><a href="#cb21-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-579"><a href="#cb21-579" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep CBSA-level rows (FIPS starts with "C") and normalize to std_cbsa if needed</span></span>
<span id="cb21-580"><a href="#cb21-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-581"><a href="#cb21-581" aria-hidden="true" tabindex="-1"></a>WAGES_named <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb21-582"><a href="#cb21-582" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_starts</span>(FIPS, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-583"><a href="#cb21-583" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">std_cbsa =</span> <span class="fu">paste0</span>(FIPS, <span class="st">"0"</span>))</span>
<span id="cb21-584"><a href="#cb21-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-585"><a href="#cb21-585" aria-hidden="true" tabindex="-1"></a><span class="co"># Total employment by CBSA-year (all industries)</span></span>
<span id="cb21-586"><a href="#cb21-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-587"><a href="#cb21-587" aria-hidden="true" tabindex="-1"></a>general_employment_cbsa <span class="ot">&lt;-</span> WAGES_named <span class="sc">|&gt;</span></span>
<span id="cb21-588"><a href="#cb21-588" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb21-589"><a href="#cb21-589" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_employment =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-590"><a href="#cb21-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-591"><a href="#cb21-591" aria-hidden="true" tabindex="-1"></a><span class="co"># Health care &amp; social assistance (NAICS 62) employment by CBSA-year</span></span>
<span id="cb21-592"><a href="#cb21-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-593"><a href="#cb21-593" aria-hidden="true" tabindex="-1"></a>health_employment_cbsa <span class="ot">&lt;-</span> WAGES_named <span class="sc">|&gt;</span></span>
<span id="cb21-594"><a href="#cb21-594" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-595"><a href="#cb21-595" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(std_cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb21-596"><a href="#cb21-596" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_employment_health =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-597"><a href="#cb21-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-598"><a href="#cb21-598" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the two</span></span>
<span id="cb21-599"><a href="#cb21-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-600"><a href="#cb21-600" aria-hidden="true" tabindex="-1"></a>table_cbsa_employment <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb21-601"><a href="#cb21-601" aria-hidden="true" tabindex="-1"></a>general_employment_cbsa, health_employment_cbsa,</span>
<span id="cb21-602"><a href="#cb21-602" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"std_cbsa"</span>, <span class="st">"YEAR"</span>)</span>
<span id="cb21-603"><a href="#cb21-603" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-604"><a href="#cb21-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-605"><a href="#cb21-605" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(table_cbsa_employment,</span>
<span id="cb21-606"><a href="#cb21-606" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> total_employment, <span class="at">y =</span> total_employment_health)) <span class="sc">+</span></span>
<span id="cb21-607"><a href="#cb21-607" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb21-608"><a href="#cb21-608" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-609"><a href="#cb21-609" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb21-610"><a href="#cb21-610" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(</span>
<span id="cb21-611"><a href="#cb21-611" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>()),</span>
<span id="cb21-612"><a href="#cb21-612" aria-hidden="true" tabindex="-1"></a><span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))</span>
<span id="cb21-613"><a href="#cb21-613" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb21-614"><a href="#cb21-614" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale_cut =</span> scales<span class="sc">::</span><span class="fu">cut_short_scale</span>())) <span class="sc">+</span></span>
<span id="cb21-615"><a href="#cb21-615" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb21-616"><a href="#cb21-616" aria-hidden="true" tabindex="-1"></a><span class="at">title   =</span> <span class="st">"Health Care &amp; Social Assistance vs. Total Employment Across CBSAs (2009–2023)"</span>,</span>
<span id="cb21-617"><a href="#cb21-617" aria-hidden="true" tabindex="-1"></a><span class="at">x       =</span> <span class="st">"Total Employment (All Industries)"</span>,</span>
<span id="cb21-618"><a href="#cb21-618" aria-hidden="true" tabindex="-1"></a><span class="at">y       =</span> <span class="st">"Employment in Health Care &amp; Social Assistance (NAICS 62)"</span>,</span>
<span id="cb21-619"><a href="#cb21-619" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="st">"Source: BLS QCEW Annual Averages"</span></span>
<span id="cb21-620"><a href="#cb21-620" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb21-621"><a href="#cb21-621" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb21-622"><a href="#cb21-622" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb21-623"><a href="#cb21-623" aria-hidden="true" tabindex="-1"></a><span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">13</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb21-624"><a href="#cb21-624" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-625"><a href="#cb21-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-626"><a href="#cb21-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evolution of Average Household Size Over Time</span></span>
<span id="cb21-627"><a href="#cb21-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-628"><a href="#cb21-628" aria-hidden="true" tabindex="-1"></a>This line plot shows average household size by CBSA over time, with NYC (35620) and Los Angeles (31080) highlighted for emphasis.</span>
<span id="cb21-631"><a href="#cb21-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-632"><a href="#cb21-632" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-avg-household-size-over-time</span></span>
<span id="cb21-633"><a href="#cb21-633" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-634"><a href="#cb21-634" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-635"><a href="#cb21-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-636"><a href="#cb21-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb21-637"><a href="#cb21-637" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5.2</span></span>
<span id="cb21-638"><a href="#cb21-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-639"><a href="#cb21-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-640"><a href="#cb21-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-641"><a href="#cb21-641" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-642"><a href="#cb21-642" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-643"><a href="#cb21-643" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb21-644"><a href="#cb21-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-645"><a href="#cb21-645" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute average household size by CBSA-year</span></span>
<span id="cb21-646"><a href="#cb21-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-647"><a href="#cb21-647" aria-hidden="true" tabindex="-1"></a>avg_household_size <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb21-648"><a href="#cb21-648" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">|&gt;</span></span>
<span id="cb21-649"><a href="#cb21-649" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb21-650"><a href="#cb21-650" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb21-651"><a href="#cb21-651" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb21-652"><a href="#cb21-652" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb21-653"><a href="#cb21-653" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_household_size =</span> population <span class="sc">/</span> households)</span>
<span id="cb21-654"><a href="#cb21-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-655"><a href="#cb21-655" aria-hidden="true" tabindex="-1"></a>nyc_la_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">35620</span>, <span class="dv">31080</span>)</span>
<span id="cb21-656"><a href="#cb21-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-657"><a href="#cb21-657" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_household_size,</span>
<span id="cb21-658"><a href="#cb21-658" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_household_size, <span class="at">group =</span> GEOID, <span class="at">color =</span> NAME)) <span class="sc">+</span></span>
<span id="cb21-659"><a href="#cb21-659" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb21-660"><a href="#cb21-660" aria-hidden="true" tabindex="-1"></a><span class="fu">gghighlight</span>(GEOID <span class="sc">%in%</span> nyc_la_ids, <span class="at">use_direct_label =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb21-661"><a href="#cb21-661" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb21-662"><a href="#cb21-662" aria-hidden="true" tabindex="-1"></a><span class="at">title    =</span> <span class="st">"Evolution of Average Household Size (2009–2023)"</span>,</span>
<span id="cb21-663"><a href="#cb21-663" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"New York (35620) and Los Angeles (31080) highlighted"</span>,</span>
<span id="cb21-664"><a href="#cb21-664" aria-hidden="true" tabindex="-1"></a><span class="at">x        =</span> <span class="st">"Year"</span>,</span>
<span id="cb21-665"><a href="#cb21-665" aria-hidden="true" tabindex="-1"></a><span class="at">y        =</span> <span class="st">"Average Household Size"</span>,</span>
<span id="cb21-666"><a href="#cb21-666" aria-hidden="true" tabindex="-1"></a><span class="at">color    =</span> <span class="st">"CBSA"</span>,</span>
<span id="cb21-667"><a href="#cb21-667" aria-hidden="true" tabindex="-1"></a><span class="at">caption  =</span> <span class="st">"Source: U.S. Census Bureau, ACS 1-Year Estimates"</span></span>
<span id="cb21-668"><a href="#cb21-668" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb21-669"><a href="#cb21-669" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2009</span>, <span class="dv">2023</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb21-670"><a href="#cb21-670" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb21-671"><a href="#cb21-671" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb21-672"><a href="#cb21-672" aria-hidden="true" tabindex="-1"></a><span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb21-673"><a href="#cb21-673" aria-hidden="true" tabindex="-1"></a><span class="at">plot.title      =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-674"><a href="#cb21-674" aria-hidden="true" tabindex="-1"></a><span class="at">plot.subtitle   =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>,  <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-675"><a href="#cb21-675" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title      =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb21-676"><a href="#cb21-676" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-677"><a href="#cb21-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-678"><a href="#cb21-678" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rent Burden Metric &amp; Standardization</span></span>
<span id="cb21-679"><a href="#cb21-679" aria-hidden="true" tabindex="-1"></a>In this step: </span>
<span id="cb21-680"><a href="#cb21-680" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>We construct a rent-to-income metric per CBSA/year; </span>
<span id="cb21-681"><a href="#cb21-681" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Standardize it two ways—by-year min–max (0–100) to compare metros within the same year, and global scales (long-term baseline = 100 and global min–max 0–100) to compare across years;</span>
<span id="cb21-682"><a href="#cb21-682" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Identify CBSAs with highest/lowest rent burden over the period. We also show an example table for a specific CBSA.</span>
<span id="cb21-685"><a href="#cb21-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-686"><a href="#cb21-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: task4-build-and-byyear-index</span></span>
<span id="cb21-687"><a href="#cb21-687" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-688"><a href="#cb21-688" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-689"><a href="#cb21-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-690"><a href="#cb21-690" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-691"><a href="#cb21-691" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-692"><a href="#cb21-692" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb21-693"><a href="#cb21-693" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb21-694"><a href="#cb21-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-695"><a href="#cb21-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-696"><a href="#cb21-696" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-697"><a href="#cb21-697" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb21-698"><a href="#cb21-698" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb21-699"><a href="#cb21-699" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-700"><a href="#cb21-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-701"><a href="#cb21-701" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Construct rent burden: % income spent on rent</span></span>
<span id="cb21-702"><a href="#cb21-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-703"><a href="#cb21-703" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb21-704"><a href="#cb21-704" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb21-705"><a href="#cb21-705" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb21-706"><a href="#cb21-706" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-707"><a href="#cb21-707" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rent_to_income =</span> <span class="dv">100</span> <span class="sc">*</span> monthly_rent <span class="sc">/</span> (household_income <span class="sc">/</span> <span class="dv">12</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-708"><a href="#cb21-708" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, rent_to_income)</span>
<span id="cb21-709"><a href="#cb21-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-710"><a href="#cb21-710" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) By-year min–max standardization (0–100), guarded for zero-range years</span></span>
<span id="cb21-711"><a href="#cb21-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-712"><a href="#cb21-712" aria-hidden="true" tabindex="-1"></a>min_max_year <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb21-713"><a href="#cb21-713" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb21-714"><a href="#cb21-714" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb21-715"><a href="#cb21-715" aria-hidden="true" tabindex="-1"></a><span class="at">.min =</span> <span class="fu">min</span>(rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-716"><a href="#cb21-716" aria-hidden="true" tabindex="-1"></a><span class="at">.max =</span> <span class="fu">max</span>(rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-717"><a href="#cb21-717" aria-hidden="true" tabindex="-1"></a><span class="at">rti_0_100_byyear =</span> <span class="fu">if_else</span>(</span>
<span id="cb21-718"><a href="#cb21-718" aria-hidden="true" tabindex="-1"></a>.max <span class="sc">&gt;</span> .min,</span>
<span id="cb21-719"><a href="#cb21-719" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> (rent_to_income <span class="sc">-</span> .min) <span class="sc">/</span> (.max <span class="sc">-</span> .min),</span>
<span id="cb21-720"><a href="#cb21-720" aria-hidden="true" tabindex="-1"></a><span class="cn">NA_real_</span></span>
<span id="cb21-721"><a href="#cb21-721" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-722"><a href="#cb21-722" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb21-723"><a href="#cb21-723" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-724"><a href="#cb21-724" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, rent_to_income, rti_0_100_byyear)</span>
<span id="cb21-725"><a href="#cb21-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-726"><a href="#cb21-726" aria-hidden="true" tabindex="-1"></a><span class="co"># Example CBSA table (Miami–Fort Lauderdale–West Palm Beach, FL -&gt; 33100)</span></span>
<span id="cb21-727"><a href="#cb21-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-728"><a href="#cb21-728" aria-hidden="true" tabindex="-1"></a>min_max_33100 <span class="ot">&lt;-</span> min_max_year <span class="sc">%&gt;%</span> <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="st">"33100"</span>)</span>
<span id="cb21-729"><a href="#cb21-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-730"><a href="#cb21-730" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> min_max_33100 <span class="sc">%&gt;%</span></span>
<span id="cb21-731"><a href="#cb21-731" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, NAME, year, rent_to_income, rti_0_100_byyear) <span class="sc">%&gt;%</span></span>
<span id="cb21-732"><a href="#cb21-732" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rent_to_income_frac =</span> rent_to_income <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-733"><a href="#cb21-733" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>rent_to_income) <span class="sc">%&gt;%</span></span>
<span id="cb21-734"><a href="#cb21-734" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(</span>
<span id="cb21-735"><a href="#cb21-735" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb21-736"><a href="#cb21-736" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Name</span><span class="st">`</span><span class="ot">=</span> NAME,</span>
<span id="cb21-737"><a href="#cb21-737" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Year</span><span class="st">`</span><span class="ot">=</span> year,</span>
<span id="cb21-738"><a href="#cb21-738" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Rent-to-Income</span><span class="st">`</span> <span class="ot">=</span> rent_to_income_frac,</span>
<span id="cb21-739"><a href="#cb21-739" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Rent Burden Index (0–100)</span><span class="st">`</span> <span class="ot">=</span> rti_0_100_byyear</span>
<span id="cb21-740"><a href="#cb21-740" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-741"><a href="#cb21-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-742"><a href="#cb21-742" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb21-743"><a href="#cb21-743" aria-hidden="true" tabindex="-1"></a>tbl,</span>
<span id="cb21-744"><a href="#cb21-744" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb21-745"><a href="#cb21-745" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb21-746"><a href="#cb21-746" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb21-747"><a href="#cb21-747" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">formatPercentage</span>(<span class="at">columns =</span> <span class="st">"Rent-to-Income"</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-748"><a href="#cb21-748" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="st">"Rent Burden Index (0–100)"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb21-749"><a href="#cb21-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-750"><a href="#cb21-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-751"><a href="#cb21-751" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpretation of Rent Burden Trends (Miami–Fort Lauderdale CBSA 33100)</span></span>
<span id="cb21-752"><a href="#cb21-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-753"><a href="#cb21-753" aria-hidden="true" tabindex="-1"></a>Between 2009 and 2018, the rent-to-income ratio in the Miami–Fort Lauderdale metropolitan area remained relatively stable, ranging from 28% to 29%, indicating that households consistently spent nearly one-third of their income on rent.</span>
<span id="cb21-754"><a href="#cb21-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-755"><a href="#cb21-755" aria-hidden="true" tabindex="-1"></a>However, the Rent Burden Index (0–100) fluctuated considerably, reflecting changes relative to other CBSAs each year.</span>
<span id="cb21-756"><a href="#cb21-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-757"><a href="#cb21-757" aria-hidden="true" tabindex="-1"></a>The index was around 72 in 2009, dipped to 62 in 2012 and 2014, and reached its peak of 81.6 in 2015, suggesting that Miami’s rent burden was among the highest in the country that year.</span>
<span id="cb21-758"><a href="#cb21-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-759"><a href="#cb21-759" aria-hidden="true" tabindex="-1"></a>The moderate decrease afterward (to ~64 by 2018) indicates slight improvement, possibly due to income growth or slower rent increases.</span>
<span id="cb21-760"><a href="#cb21-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-761"><a href="#cb21-761" aria-hidden="true" tabindex="-1"></a>Overall, Miami remained a high-rent-burden metro area throughout the decade, with minor year-to-year shifts influenced more by national relative comparisons than by large local changes in the rent-to-income ratio itself.</span>
<span id="cb21-762"><a href="#cb21-762" aria-hidden="true" tabindex="-1"></a><span class="fu">## Global scales (long-term baseline = 100; global min–max 0–100)</span></span>
<span id="cb21-765"><a href="#cb21-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-766"><a href="#cb21-766" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: task4-global-indices</span></span>
<span id="cb21-767"><a href="#cb21-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-768"><a href="#cb21-768" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-769"><a href="#cb21-769" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-770"><a href="#cb21-770" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-771"><a href="#cb21-771" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-772"><a href="#cb21-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb21-773"><a href="#cb21-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb21-774"><a href="#cb21-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-775"><a href="#cb21-775" aria-hidden="true" tabindex="-1"></a><span class="co"># Long-term national stats (across all CBSAs/years)</span></span>
<span id="cb21-776"><a href="#cb21-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-777"><a href="#cb21-777" aria-hidden="true" tabindex="-1"></a>nat_longterm_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-778"><a href="#cb21-778" aria-hidden="true" tabindex="-1"></a>nat_longterm_sd   <span class="ot">&lt;-</span> <span class="fu">sd</span>(rent_burden<span class="sc">$</span>rent_to_income,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-779"><a href="#cb21-779" aria-hidden="true" tabindex="-1"></a>nat_min           <span class="ot">&lt;-</span> <span class="fu">min</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-780"><a href="#cb21-780" aria-hidden="true" tabindex="-1"></a>nat_max           <span class="ot">&lt;-</span> <span class="fu">max</span>(rent_burden<span class="sc">$</span>rent_to_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-781"><a href="#cb21-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-782"><a href="#cb21-782" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline 100 at long-term national average</span></span>
<span id="cb21-783"><a href="#cb21-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-784"><a href="#cb21-784" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb21-785"><a href="#cb21-785" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rti_index_longterm100 =</span> <span class="dv">100</span> <span class="sc">*</span> rent_to_income <span class="sc">/</span> nat_longterm_mean)</span>
<span id="cb21-786"><a href="#cb21-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-787"><a href="#cb21-787" aria-hidden="true" tabindex="-1"></a><span class="co"># Global min–max 0–100 across all years</span></span>
<span id="cb21-788"><a href="#cb21-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-789"><a href="#cb21-789" aria-hidden="true" tabindex="-1"></a>rent_burden <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb21-790"><a href="#cb21-790" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">rti_minmax_0_100 =</span> <span class="dv">100</span> <span class="sc">*</span> (rent_to_income <span class="sc">-</span> nat_min) <span class="sc">/</span> (nat_max <span class="sc">-</span> nat_min))</span>
<span id="cb21-791"><a href="#cb21-791" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-792"><a href="#cb21-792" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top/Bottom CBSAs on global index + result tables</span></span>
<span id="cb21-795"><a href="#cb21-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-796"><a href="#cb21-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: task4-top-bottom-tables</span></span>
<span id="cb21-797"><a href="#cb21-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-798"><a href="#cb21-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-799"><a href="#cb21-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-800"><a href="#cb21-800" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-801"><a href="#cb21-801" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code"</span></span>
<span id="cb21-802"><a href="#cb21-802" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb21-803"><a href="#cb21-803" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb21-804"><a href="#cb21-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-805"><a href="#cb21-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-806"><a href="#cb21-806" aria-hidden="true" tabindex="-1"></a><span class="co"># Extremes by CBSA</span></span>
<span id="cb21-807"><a href="#cb21-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-808"><a href="#cb21-808" aria-hidden="true" tabindex="-1"></a>cbsa_max <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb21-809"><a href="#cb21-809" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb21-810"><a href="#cb21-810" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">max_idx =</span> <span class="fu">max</span>(rti_minmax_0_100, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-811"><a href="#cb21-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-812"><a href="#cb21-812" aria-hidden="true" tabindex="-1"></a>cbsa_min <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb21-813"><a href="#cb21-813" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb21-814"><a href="#cb21-814" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">min_idx =</span> <span class="fu">min</span>(rti_minmax_0_100, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb21-815"><a href="#cb21-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-816"><a href="#cb21-816" aria-hidden="true" tabindex="-1"></a>top5_overall    <span class="ot">&lt;-</span> cbsa_max <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(max_idx, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-817"><a href="#cb21-817" aria-hidden="true" tabindex="-1"></a>bottom5_overall <span class="ot">&lt;-</span> cbsa_min <span class="sc">%&gt;%</span> <span class="fu">slice_min</span>(min_idx, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-818"><a href="#cb21-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-819"><a href="#cb21-819" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional list to highlight in plots</span></span>
<span id="cb21-820"><a href="#cb21-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-821"><a href="#cb21-821" aria-hidden="true" tabindex="-1"></a>to_highlight <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb21-822"><a href="#cb21-822" aria-hidden="true" tabindex="-1"></a>top5_overall <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, NAME),</span>
<span id="cb21-823"><a href="#cb21-823" aria-hidden="true" tabindex="-1"></a>bottom5_overall <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, NAME)</span>
<span id="cb21-824"><a href="#cb21-824" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb21-825"><a href="#cb21-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-826"><a href="#cb21-826" aria-hidden="true" tabindex="-1"></a><span class="co"># Display tables</span></span>
<span id="cb21-827"><a href="#cb21-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-828"><a href="#cb21-828" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb21-829"><a href="#cb21-829" aria-hidden="true" tabindex="-1"></a>top5_overall <span class="sc">%&gt;%</span></span>
<span id="cb21-830"><a href="#cb21-830" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(</span>
<span id="cb21-831"><a href="#cb21-831" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb21-832"><a href="#cb21-832" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Name</span><span class="st">`</span><span class="ot">=</span> NAME,</span>
<span id="cb21-833"><a href="#cb21-833" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Max Rent Burden Index Long Years (0–100)</span><span class="st">`</span> <span class="ot">=</span> max_idx</span>
<span id="cb21-834"><a href="#cb21-834" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb21-835"><a href="#cb21-835" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb21-836"><a href="#cb21-836" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb21-837"><a href="#cb21-837" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> DT<span class="sc">::</span><span class="fu">formatRound</span>(<span class="st">"Max Rent Burden Index Long Years (0–100)"</span>, <span class="dv">2</span>)</span>
<span id="cb21-838"><a href="#cb21-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-839"><a href="#cb21-839" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb21-840"><a href="#cb21-840" aria-hidden="true" tabindex="-1"></a>bottom5_overall <span class="sc">%&gt;%</span></span>
<span id="cb21-841"><a href="#cb21-841" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(</span>
<span id="cb21-842"><a href="#cb21-842" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">CBSA</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb21-843"><a href="#cb21-843" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Name</span><span class="st">`</span><span class="ot">=</span> NAME,</span>
<span id="cb21-844"><a href="#cb21-844" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Min Rent Burden Index Long Years (0–100)</span><span class="st">`</span> <span class="ot">=</span> min_idx</span>
<span id="cb21-845"><a href="#cb21-845" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb21-846"><a href="#cb21-846" aria-hidden="true" tabindex="-1"></a><span class="at">options =</span> <span class="fu">list</span>(<span class="at">searching =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>, <span class="at">pageLength =</span> <span class="dv">10</span>),</span>
<span id="cb21-847"><a href="#cb21-847" aria-hidden="true" tabindex="-1"></a><span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb21-848"><a href="#cb21-848" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> DT<span class="sc">::</span><span class="fu">formatRound</span>(<span class="st">"Min Rent Burden Index Long Years (0–100)"</span>, <span class="dv">2</span>)</span>
<span id="cb21-849"><a href="#cb21-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-850"><a href="#cb21-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-851"><a href="#cb21-851" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretation — National Extremes</span></span>
<span id="cb21-852"><a href="#cb21-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-853"><a href="#cb21-853" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Highest burdens: Puerto Rican metro/micro areas dominate the top-5, with indices up to ~100, indicating households devote a much larger share of income to rent than the U.S. long-term average. Persistent high burdens likely reflect income constraints, disaster recovery pressures, and tight housing markets.</span>
<span id="cb21-854"><a href="#cb21-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-855"><a href="#cb21-855" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Lowest burdens: Smaller inland CBSAs (e.g., Bismarck, ND; Jefferson City, MO) show indices near 0–2, meaning rent is a small share of income. These regions tend to have moderate rents and incomes sufficient to keep burdens low.</span>
<span id="cb21-856"><a href="#cb21-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-857"><a href="#cb21-857" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualizing “YIMBY” Patterns</span></span>
<span id="cb21-858"><a href="#cb21-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-859"><a href="#cb21-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-862"><a href="#cb21-862" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-863"><a href="#cb21-863" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: t6-setup-build-hg_rate</span></span>
<span id="cb21-864"><a href="#cb21-864" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-865"><a href="#cb21-865" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-866"><a href="#cb21-866" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-867"><a href="#cb21-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-868"><a href="#cb21-868" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-869"><a href="#cb21-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-870"><a href="#cb21-870" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Avg household size</span></span>
<span id="cb21-871"><a href="#cb21-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-872"><a href="#cb21-872" aria-hidden="true" tabindex="-1"></a>avg_household_size <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb21-873"><a href="#cb21-873" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, year, population, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb21-874"><a href="#cb21-874" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(HOUSEHOLDS <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, households), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-875"><a href="#cb21-875" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">avg_household_size =</span> population <span class="sc">/</span> households) <span class="sc">%&gt;%</span></span>
<span id="cb21-876"><a href="#cb21-876" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, year, NAME, population, avg_household_size)</span>
<span id="cb21-877"><a href="#cb21-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-878"><a href="#cb21-878" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Join permits</span></span>
<span id="cb21-879"><a href="#cb21-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-880"><a href="#cb21-880" aria-hidden="true" tabindex="-1"></a>housing_growth_base <span class="ot">&lt;-</span> avg_household_size <span class="sc">%&gt;%</span></span>
<span id="cb21-881"><a href="#cb21-881" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(PERMITS <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, year, new_housing_units_permitted),</span>
<span id="cb21-882"><a href="#cb21-882" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>))</span>
<span id="cb21-883"><a href="#cb21-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-884"><a href="#cb21-884" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Instantaneous housing growth rate</span></span>
<span id="cb21-885"><a href="#cb21-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-886"><a href="#cb21-886" aria-hidden="true" tabindex="-1"></a>hg_rate <span class="ot">&lt;-</span> housing_growth_base <span class="sc">%&gt;%</span></span>
<span id="cb21-887"><a href="#cb21-887" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">hg_rate_CBSA =</span> <span class="dv">100</span> <span class="sc">*</span> (new_housing_units_permitted <span class="sc">*</span> avg_household_size) <span class="sc">/</span> population)</span>
<span id="cb21-888"><a href="#cb21-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-889"><a href="#cb21-889" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Global min–max 0–100 (guard handled OUTSIDE mutate)</span></span>
<span id="cb21-890"><a href="#cb21-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-891"><a href="#cb21-891" aria-hidden="true" tabindex="-1"></a>hg_min <span class="ot">&lt;-</span> <span class="fu">min</span>(hg_rate<span class="sc">$</span>hg_rate_CBSA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-892"><a href="#cb21-892" aria-hidden="true" tabindex="-1"></a>hg_max <span class="ot">&lt;-</span> <span class="fu">max</span>(hg_rate<span class="sc">$</span>hg_rate_CBSA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-893"><a href="#cb21-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-894"><a href="#cb21-894" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.finite</span>(hg_max <span class="sc">-</span> hg_min) <span class="sc">&amp;&amp;</span> (hg_max <span class="sc">&gt;</span> hg_min)) {</span>
<span id="cb21-895"><a href="#cb21-895" aria-hidden="true" tabindex="-1"></a>hg_rate <span class="ot">&lt;-</span> hg_rate <span class="sc">%&gt;%</span></span>
<span id="cb21-896"><a href="#cb21-896" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">hg_minmax_0_100 =</span> <span class="dv">100</span> <span class="sc">*</span> (hg_rate_CBSA <span class="sc">-</span> hg_min) <span class="sc">/</span> (hg_max <span class="sc">-</span> hg_min))</span>
<span id="cb21-897"><a href="#cb21-897" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb21-898"><a href="#cb21-898" aria-hidden="true" tabindex="-1"></a>hg_rate <span class="ot">&lt;-</span> hg_rate <span class="sc">%&gt;%</span></span>
<span id="cb21-899"><a href="#cb21-899" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">hg_minmax_0_100 =</span> <span class="cn">NA_real_</span>)</span>
<span id="cb21-900"><a href="#cb21-900" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-901"><a href="#cb21-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-902"><a href="#cb21-902" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only what you need later</span></span>
<span id="cb21-903"><a href="#cb21-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-904"><a href="#cb21-904" aria-hidden="true" tabindex="-1"></a>hg_rate <span class="ot">&lt;-</span> hg_rate <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, NAME, year, hg_rate_CBSA, hg_minmax_0_100)</span>
<span id="cb21-905"><a href="#cb21-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-906"><a href="#cb21-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-907"><a href="#cb21-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-910"><a href="#cb21-910" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-911"><a href="#cb21-911" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: t6-build-rent-growth</span></span>
<span id="cb21-912"><a href="#cb21-912" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-913"><a href="#cb21-913" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-914"><a href="#cb21-914" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-915"><a href="#cb21-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-916"><a href="#cb21-916" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-917"><a href="#cb21-917" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb21-918"><a href="#cb21-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-919"><a href="#cb21-919" aria-hidden="true" tabindex="-1"></a><span class="co"># Join on GEOID + year; keep only needed columns</span></span>
<span id="cb21-920"><a href="#cb21-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-921"><a href="#cb21-921" aria-hidden="true" tabindex="-1"></a>rent_growth <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb21-922"><a href="#cb21-922" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(GEOID, year, rent_to_income) <span class="sc">%&gt;%</span></span>
<span id="cb21-923"><a href="#cb21-923" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(</span>
<span id="cb21-924"><a href="#cb21-924" aria-hidden="true" tabindex="-1"></a>hg_rate <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, hg_rate_CBSA, hg_minmax_0_100),</span>
<span id="cb21-925"><a href="#cb21-925" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb21-926"><a href="#cb21-926" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb21-927"><a href="#cb21-927" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(</span>
<span id="cb21-928"><a href="#cb21-928" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population, NAME),</span>
<span id="cb21-929"><a href="#cb21-929" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb21-930"><a href="#cb21-930" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb21-931"><a href="#cb21-931" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(GEOID, year)</span>
<span id="cb21-932"><a href="#cb21-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-933"><a href="#cb21-933" aria-hidden="true" tabindex="-1"></a><span class="co"># One row per CBSA with start/end values and averages across the window</span></span>
<span id="cb21-934"><a href="#cb21-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-935"><a href="#cb21-935" aria-hidden="true" tabindex="-1"></a>rent_summary <span class="ot">&lt;-</span> rent_growth <span class="sc">%&gt;%</span></span>
<span id="cb21-936"><a href="#cb21-936" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb21-937"><a href="#cb21-937" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(</span>
<span id="cb21-938"><a href="#cb21-938" aria-hidden="true" tabindex="-1"></a><span class="at">start_year  =</span> <span class="fu">first</span>(year),</span>
<span id="cb21-939"><a href="#cb21-939" aria-hidden="true" tabindex="-1"></a><span class="at">end_year    =</span> <span class="fu">last</span>(year),</span>
<span id="cb21-940"><a href="#cb21-940" aria-hidden="true" tabindex="-1"></a><span class="at">start_rent  =</span> <span class="fu">first</span>(rent_to_income),</span>
<span id="cb21-941"><a href="#cb21-941" aria-hidden="true" tabindex="-1"></a><span class="at">end_rent    =</span> <span class="fu">last</span>(rent_to_income),</span>
<span id="cb21-942"><a href="#cb21-942" aria-hidden="true" tabindex="-1"></a><span class="at">rent_change =</span> end_rent <span class="sc">-</span> start_rent,           <span class="co"># ↓ is good (burden fell)</span></span>
<span id="cb21-943"><a href="#cb21-943" aria-hidden="true" tabindex="-1"></a><span class="at">start_pop   =</span> <span class="fu">first</span>(population),</span>
<span id="cb21-944"><a href="#cb21-944" aria-hidden="true" tabindex="-1"></a><span class="at">end_pop     =</span> <span class="fu">last</span>(population),</span>
<span id="cb21-945"><a href="#cb21-945" aria-hidden="true" tabindex="-1"></a><span class="at">pop_change  =</span> end_pop <span class="sc">-</span> start_pop,             <span class="co"># ↑ is good (population grew)</span></span>
<span id="cb21-946"><a href="#cb21-946" aria-hidden="true" tabindex="-1"></a><span class="at">mean_housing_growth =</span> <span class="fu">mean</span>(hg_rate_CBSA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-947"><a href="#cb21-947" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb21-948"><a href="#cb21-948" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-949"><a href="#cb21-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-950"><a href="#cb21-950" aria-hidden="true" tabindex="-1"></a><span class="co"># YIMBY candidates: high early rent burden, falling rent burden, growing population, above-avg supply growth</span></span>
<span id="cb21-951"><a href="#cb21-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-952"><a href="#cb21-952" aria-hidden="true" tabindex="-1"></a>yimby_cities <span class="ot">&lt;-</span> rent_summary <span class="sc">%&gt;%</span></span>
<span id="cb21-953"><a href="#cb21-953" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(</span>
<span id="cb21-954"><a href="#cb21-954" aria-hidden="true" tabindex="-1"></a>start_rent <span class="sc">&gt;</span> <span class="fu">median</span>(start_rent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-955"><a href="#cb21-955" aria-hidden="true" tabindex="-1"></a>rent_change <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb21-956"><a href="#cb21-956" aria-hidden="true" tabindex="-1"></a>pop_change  <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb21-957"><a href="#cb21-957" aria-hidden="true" tabindex="-1"></a>mean_housing_growth <span class="sc">&gt;</span> <span class="fu">mean</span>(mean_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-958"><a href="#cb21-958" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-959"><a href="#cb21-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-960"><a href="#cb21-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-961"><a href="#cb21-961" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualization A — Housing growth vs. change in rent burden (CBSA-level)</span></span>
<span id="cb21-964"><a href="#cb21-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-965"><a href="#cb21-965" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: t6-viz-scatter-yimby</span></span>
<span id="cb21-966"><a href="#cb21-966" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-967"><a href="#cb21-967" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-968"><a href="#cb21-968" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-969"><a href="#cb21-969" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7.5</span></span>
<span id="cb21-970"><a href="#cb21-970" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb21-971"><a href="#cb21-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-972"><a href="#cb21-972" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-973"><a href="#cb21-973" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb21-974"><a href="#cb21-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-975"><a href="#cb21-975" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rent_summary, <span class="fu">aes</span>(<span class="at">x =</span> mean_housing_growth, <span class="at">y =</span> rent_change)) <span class="sc">+</span></span>
<span id="cb21-976"><a href="#cb21-976" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb21-977"><a href="#cb21-977" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(rent_summary<span class="sc">$</span>mean_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-978"><a href="#cb21-978" aria-hidden="true" tabindex="-1"></a><span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb21-979"><a href="#cb21-979" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"gray60"</span>) <span class="sc">+</span></span>
<span id="cb21-980"><a href="#cb21-980" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> yimby_cities, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-981"><a href="#cb21-981" aria-hidden="true" tabindex="-1"></a>ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb21-982"><a href="#cb21-982" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> yimby_cities,</span>
<span id="cb21-983"><a href="#cb21-983" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">label =</span> NAME),</span>
<span id="cb21-984"><a href="#cb21-984" aria-hidden="true" tabindex="-1"></a><span class="at">size =</span> <span class="dv">3</span>, <span class="at">max.overlaps =</span> <span class="dv">20</span>, <span class="at">seed =</span> <span class="dv">42</span>, <span class="at">box.padding =</span> <span class="fl">0.3</span></span>
<span id="cb21-985"><a href="#cb21-985" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb21-986"><a href="#cb21-986" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb21-987"><a href="#cb21-987" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"More Building, Lower Rents? (CBSA-level, 2009–2023)"</span>,</span>
<span id="cb21-988"><a href="#cb21-988" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"Quadrants: lower y = falling rent burden; right = higher average housing growth"</span>,</span>
<span id="cb21-989"><a href="#cb21-989" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Average Housing Growth (instantaneous rate)"</span>,</span>
<span id="cb21-990"><a href="#cb21-990" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Change in Rent Burden (end − start, percentage points)"</span></span>
<span id="cb21-991"><a href="#cb21-991" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb21-992"><a href="#cb21-992" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb21-993"><a href="#cb21-993" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb21-994"><a href="#cb21-994" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-995"><a href="#cb21-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-996"><a href="#cb21-996" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretation (Visualization A).</span></span>
<span id="cb21-997"><a href="#cb21-997" aria-hidden="true" tabindex="-1"></a>This scatter shows how housing supply growth relates to affordability changes. CBSAs in the lower-right quadrant combine above-average housing growth with declining rent burden—the hallmark of a YIMBY outcome. Your labeled candidates (in green) illustrate cases where stronger construction coincided with improved affordability, supporting the idea that more building can help stabilize rents even as demand rises. Areas in the upper-right quadrant still built a lot but saw rent burden increase, implying supply didn’t fully keep pace with demand.</span>
<span id="cb21-998"><a href="#cb21-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-999"><a href="#cb21-999" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualization B — Rent burden (solid) vs. housing growth index (dashed) over time</span></span>
<span id="cb21-1002"><a href="#cb21-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-1003"><a href="#cb21-1003" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: t6-viz-timeseries-highlight</span></span>
<span id="cb21-1004"><a href="#cb21-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-1005"><a href="#cb21-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-1006"><a href="#cb21-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-1007"><a href="#cb21-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb21-1008"><a href="#cb21-1008" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5.2</span></span>
<span id="cb21-1009"><a href="#cb21-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1010"><a href="#cb21-1010" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb21-1011"><a href="#cb21-1011" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-1012"><a href="#cb21-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1013"><a href="#cb21-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick a few exemplars to highlight (edit as you like)</span></span>
<span id="cb21-1014"><a href="#cb21-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1015"><a href="#cb21-1015" aria-hidden="true" tabindex="-1"></a>highlight_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-1016"><a href="#cb21-1016" aria-hidden="true" tabindex="-1"></a><span class="st">"Austin-Round Rock-Georgetown, TX Metro Area"</span>,</span>
<span id="cb21-1017"><a href="#cb21-1017" aria-hidden="true" tabindex="-1"></a><span class="st">"Raleigh-Cary, NC Metro Area"</span>,</span>
<span id="cb21-1018"><a href="#cb21-1018" aria-hidden="true" tabindex="-1"></a><span class="st">"Boise City, ID Metro Area"</span></span>
<span id="cb21-1019"><a href="#cb21-1019" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-1020"><a href="#cb21-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1021"><a href="#cb21-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rent_growth, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">group =</span> NAME, <span class="at">color =</span> NAME)) <span class="sc">+</span></span>
<span id="cb21-1022"><a href="#cb21-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> rent_to_income), <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb21-1023"><a href="#cb21-1023" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> hg_minmax_0_100), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb21-1024"><a href="#cb21-1024" aria-hidden="true" tabindex="-1"></a><span class="fu">gghighlight</span>(NAME <span class="sc">%in%</span> highlight_names,</span>
<span id="cb21-1025"><a href="#cb21-1025" aria-hidden="true" tabindex="-1"></a><span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fl">0.08</span>, <span class="at">color =</span> <span class="st">"gray60"</span>),</span>
<span id="cb21-1026"><a href="#cb21-1026" aria-hidden="true" tabindex="-1"></a><span class="at">use_direct_label =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb21-1027"><a href="#cb21-1027" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb21-1028"><a href="#cb21-1028" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"Rent Burden (solid) vs. Housing Growth (dashed), Over Time"</span>,</span>
<span id="cb21-1029"><a href="#cb21-1029" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"Highlighted CBSAs show falling rent burden with rising housing growth"</span>,</span>
<span id="cb21-1030"><a href="#cb21-1030" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb21-1031"><a href="#cb21-1031" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Index / Percentage"</span>,</span>
<span id="cb21-1032"><a href="#cb21-1032" aria-hidden="true" tabindex="-1"></a><span class="at">color =</span> <span class="st">"CBSA"</span></span>
<span id="cb21-1033"><a href="#cb21-1033" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb21-1034"><a href="#cb21-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb21-1035"><a href="#cb21-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb21-1036"><a href="#cb21-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1037"><a href="#cb21-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1038"><a href="#cb21-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretation (Visualization B).</span></span>
<span id="cb21-1039"><a href="#cb21-1039" aria-hidden="true" tabindex="-1"></a>This time-series overlay lets you track whether rent burden trends (solid) improve as housing growth (dashed) strengthens. Highlighted CBSAs show a declining rent-to-income trend while the housing growth index rises, meeting key YIMBY criteria. Where the dashed line rises without a corresponding fall in the solid line, supply likely lagged demand (or income growth lagged), so affordability didn’t improve.</span>
<span id="cb21-1040"><a href="#cb21-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1041"><a href="#cb21-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">## 🏙️ Policy Brief: The Federal YIMBY Housing Acceleration Act</span></span>
<span id="cb21-1042"><a href="#cb21-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">### *Encouraging Local Growth Through Smarter Federal Incentives*</span></span>
<span id="cb21-1043"><a href="#cb21-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1044"><a href="#cb21-1044" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb21-1045"><a href="#cb21-1045" aria-hidden="true" tabindex="-1"></a>**Objective:**  </span>
<span id="cb21-1046"><a href="#cb21-1046" aria-hidden="true" tabindex="-1"></a>Promote housing affordability and sustainable development by incentivizing municipalities that successfully reduce rent burden while increasing housing supply.</span>
<span id="cb21-1047"><a href="#cb21-1047" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-1048"><a href="#cb21-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1051"><a href="#cb21-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-1052"><a href="#cb21-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pb-setup-yimby-objs</span></span>
<span id="cb21-1053"><a href="#cb21-1053" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-1054"><a href="#cb21-1054" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb21-1055"><a href="#cb21-1055" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb21-1056"><a href="#cb21-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1057"><a href="#cb21-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># This setup assumes you already created:</span></span>
<span id="cb21-1058"><a href="#cb21-1058" aria-hidden="true" tabindex="-1"></a><span class="co"># - rent_burden: GEOID, NAME, year, rent_to_income</span></span>
<span id="cb21-1059"><a href="#cb21-1059" aria-hidden="true" tabindex="-1"></a><span class="co"># - hg_rate:     GEOID, NAME, year, hg_rate_CBSA, hg_minmax_0_100</span></span>
<span id="cb21-1060"><a href="#cb21-1060" aria-hidden="true" tabindex="-1"></a><span class="co"># - POPULATION:  GEOID, year, population, NAME</span></span>
<span id="cb21-1061"><a href="#cb21-1061" aria-hidden="true" tabindex="-1"></a><span class="co"># If not present, stop with a helpful message.</span></span>
<span id="cb21-1062"><a href="#cb21-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1063"><a href="#cb21-1063" aria-hidden="true" tabindex="-1"></a>need <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">c</span>(<span class="st">"rent_burden"</span>,<span class="st">"hg_rate"</span>,<span class="st">"POPULATION"</span>), <span class="fu">ls</span>())</span>
<span id="cb21-1064"><a href="#cb21-1064" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(need) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb21-1065"><a href="#cb21-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Missing objects: "</span>, <span class="fu">paste</span>(need, <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb21-1066"><a href="#cb21-1066" aria-hidden="true" tabindex="-1"></a>       <span class="st">". Build them earlier (Tasks 3–5) before this section."</span>)</span>
<span id="cb21-1067"><a href="#cb21-1067" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-1068"><a href="#cb21-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1069"><a href="#cb21-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-1070"><a href="#cb21-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1071"><a href="#cb21-1071" aria-hidden="true" tabindex="-1"></a><span class="co"># Build analysis tables (idempotent)</span></span>
<span id="cb21-1072"><a href="#cb21-1072" aria-hidden="true" tabindex="-1"></a>rent_growth <span class="ot">&lt;-</span> rent_burden <span class="sc">%&gt;%</span></span>
<span id="cb21-1073"><a href="#cb21-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, year, rent_to_income) <span class="sc">%&gt;%</span></span>
<span id="cb21-1074"><a href="#cb21-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb21-1075"><a href="#cb21-1075" aria-hidden="true" tabindex="-1"></a>    hg_rate <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, hg_rate_CBSA, hg_minmax_0_100),</span>
<span id="cb21-1076"><a href="#cb21-1076" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb21-1077"><a href="#cb21-1077" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-1078"><a href="#cb21-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb21-1079"><a href="#cb21-1079" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population, NAME),</span>
<span id="cb21-1080"><a href="#cb21-1080" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb21-1081"><a href="#cb21-1081" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-1082"><a href="#cb21-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, year)</span>
<span id="cb21-1083"><a href="#cb21-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1084"><a href="#cb21-1084" aria-hidden="true" tabindex="-1"></a>rent_summary <span class="ot">&lt;-</span> rent_growth <span class="sc">%&gt;%</span></span>
<span id="cb21-1085"><a href="#cb21-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb21-1086"><a href="#cb21-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb21-1087"><a href="#cb21-1087" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_year  =</span> <span class="fu">first</span>(year),</span>
<span id="cb21-1088"><a href="#cb21-1088" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_year    =</span> <span class="fu">last</span>(year),</span>
<span id="cb21-1089"><a href="#cb21-1089" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_rent  =</span> <span class="fu">first</span>(rent_to_income),</span>
<span id="cb21-1090"><a href="#cb21-1090" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_rent    =</span> <span class="fu">last</span>(rent_to_income),</span>
<span id="cb21-1091"><a href="#cb21-1091" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_change =</span> end_rent <span class="sc">-</span> start_rent,           <span class="co"># ↓ good</span></span>
<span id="cb21-1092"><a href="#cb21-1092" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_pop   =</span> <span class="fu">first</span>(population),</span>
<span id="cb21-1093"><a href="#cb21-1093" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_pop     =</span> <span class="fu">last</span>(population),</span>
<span id="cb21-1094"><a href="#cb21-1094" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_change  =</span> end_pop <span class="sc">-</span> start_pop,             <span class="co"># ↑ good</span></span>
<span id="cb21-1095"><a href="#cb21-1095" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_housing_growth =</span> <span class="fu">mean</span>(hg_rate_CBSA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-1096"><a href="#cb21-1096" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb21-1097"><a href="#cb21-1097" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-1098"><a href="#cb21-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1099"><a href="#cb21-1099" aria-hidden="true" tabindex="-1"></a>yimby_cities <span class="ot">&lt;-</span> rent_summary <span class="sc">%&gt;%</span></span>
<span id="cb21-1100"><a href="#cb21-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb21-1101"><a href="#cb21-1101" aria-hidden="true" tabindex="-1"></a>    start_rent <span class="sc">&gt;</span> <span class="fu">median</span>(start_rent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),       <span class="co"># high early burden</span></span>
<span id="cb21-1102"><a href="#cb21-1102" aria-hidden="true" tabindex="-1"></a>    rent_change <span class="sc">&lt;</span> <span class="dv">0</span>,                                     <span class="co"># burden fell</span></span>
<span id="cb21-1103"><a href="#cb21-1103" aria-hidden="true" tabindex="-1"></a>    pop_change  <span class="sc">&gt;</span> <span class="dv">0</span>,                                     <span class="co"># population grew</span></span>
<span id="cb21-1104"><a href="#cb21-1104" aria-hidden="true" tabindex="-1"></a>    mean_housing_growth <span class="sc">&gt;</span> <span class="fu">mean</span>(mean_housing_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># above-avg supply</span></span>
<span id="cb21-1105"><a href="#cb21-1105" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-1106"><a href="#cb21-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1107"><a href="#cb21-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Analytical Findings</span></span>
<span id="cb21-1108"><a href="#cb21-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1109"><a href="#cb21-1109" aria-hidden="true" tabindex="-1"></a>Our analysis of U.S. **Census Bureau (ACS)** and **Bureau of Labor Statistics (BLS)** data reveals a clear divide between YIMBY success stories and NIMBY-constrained cities.</span>
<span id="cb21-1110"><a href="#cb21-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1111"><a href="#cb21-1111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**YIMBY Success Cities** — *Austin (TX), Raleigh (NC), Boise (ID)*  </span>
<span id="cb21-1112"><a href="#cb21-1112" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Experienced **high housing growth**, **declining rent burdens**, and **steady population gains**.  </span>
<span id="cb21-1113"><a href="#cb21-1113" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>These metros demonstrate that balanced housing supply stabilizes rent levels even amid rapid growth.</span>
<span id="cb21-1114"><a href="#cb21-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1115"><a href="#cb21-1115" aria-hidden="true" tabindex="-1"></a>These metros demonstrate that balanced housing supply stabilizes rent levels even amid rapid growth.</span>
<span id="cb21-1116"><a href="#cb21-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1117"><a href="#cb21-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**NIMBY Cities** — *Los Angeles (CA), Miami (FL)*  </span>
<span id="cb21-1118"><a href="#cb21-1118" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Display **persistently high rent burdens** and **limited new housing development**, signaling affordability stress and restrictive zoning barriers.</span>
<span id="cb21-1119"><a href="#cb21-1119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-1120"><a href="#cb21-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">### Proposed Congressional Sponsors</span></span>
<span id="cb21-1121"><a href="#cb21-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1122"><a href="#cb21-1122" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Primary Sponsor:** Representative from **Austin, TX** — a proven *YIMBY leader* that balanced affordability with growth through streamlined zoning and development incentives.  </span>
<span id="cb21-1123"><a href="#cb21-1123" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Co-Sponsor:** Representative from **Los Angeles, CA** — a *high-cost, low-supply* metro that stands to gain from national housing reform.</span>
<span id="cb21-1124"><a href="#cb21-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1125"><a href="#cb21-1125" aria-hidden="true" tabindex="-1"></a>Together, they embody the coalition needed to address America’s affordability crisis.</span>
<span id="cb21-1126"><a href="#cb21-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1127"><a href="#cb21-1127" aria-hidden="true" tabindex="-1"></a><span class="fu">### Strategic Labor and Industry Partnerships</span></span>
<span id="cb21-1128"><a href="#cb21-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1129"><a href="#cb21-1129" aria-hidden="true" tabindex="-1"></a>| Sector | Why It Matters | Projected Impact |</span>
<span id="cb21-1130"><a href="#cb21-1130" aria-hidden="true" tabindex="-1"></a>|:--|:--|:--|</span>
<span id="cb21-1131"><a href="#cb21-1131" aria-hidden="true" tabindex="-1"></a>| **Construction (NAICS 23)** | Increased development creates jobs and supports union contractors. | Sustained rise in housing starts adds thousands of jobs nationwide. |</span>
<span id="cb21-1132"><a href="#cb21-1132" aria-hidden="true" tabindex="-1"></a>| **Education &amp; Public Safety (NAICS 61 &amp; 92)** | High rents limit where teachers, firefighters, and police can live. | Lower rent burdens allow essential workers to reside near workplaces. |</span>
<span id="cb21-1133"><a href="#cb21-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1134"><a href="#cb21-1134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recommended Evaluation Metrics</span></span>
<span id="cb21-1135"><a href="#cb21-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1136"><a href="#cb21-1136" aria-hidden="true" tabindex="-1"></a>| Metric | Description | Interpretation |</span>
<span id="cb21-1137"><a href="#cb21-1137" aria-hidden="true" tabindex="-1"></a>|:--|:--|:--|</span>
<span id="cb21-1138"><a href="#cb21-1138" aria-hidden="true" tabindex="-1"></a>| **Rent Burden Index (RBI)** | Share of income spent on rent, standardized to a common 0–100 scale across metros. | Higher values = higher cost pressure; falling values over time signal improved affordability. |</span>
<span id="cb21-1139"><a href="#cb21-1139" aria-hidden="true" tabindex="-1"></a>| **Housing Growth Rate (HGR)** | New housing units permitted relative to population, standardized to 0–100. | Higher values = stronger housing expansion; sustained increases indicate supply responsiveness. |</span>
<span id="cb21-1140"><a href="#cb21-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1141"><a href="#cb21-1141" aria-hidden="true" tabindex="-1"></a>A *“High-YIMBY” city* scores **low RBI** and **high HGR** over time, qualifying for federal funding and recognition.</span>
<span id="cb21-1142"><a href="#cb21-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1143"><a href="#cb21-1143" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb21-1144"><a href="#cb21-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1145"><a href="#cb21-1145" aria-hidden="true" tabindex="-1"></a>The analysis conducted through this project highlights a clear and data-driven story: **cities that embrace YIMBY (“Yes In My Backyard”) housing policies thrive**—they sustain population growth, reduce rent burdens, and maintain balanced, inclusive urban development.  </span>
<span id="cb21-1146"><a href="#cb21-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1147"><a href="#cb21-1147" aria-hidden="true" tabindex="-1"></a>By comparing rent burden and housing growth metrics across Core-Based Statistical Areas (CBSAs), we identified metros like **Austin, TX**, **Raleigh, NC**, and **Boise, ID** as examples of YIMBY success. These regions demonstrate how proactive zoning reform, faster permitting, and public–private coordination can yield tangible results in affordability and livability.</span>
<span id="cb21-1148"><a href="#cb21-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1149"><a href="#cb21-1149" aria-hidden="true" tabindex="-1"></a>Conversely, high-cost metros such as **Los Angeles, CA** and **Miami, FL** face growing affordability challenges. Their stagnant housing growth and persistently high rent burdens underscore the urgent need for **federal intervention** and incentive alignment.</span>
<span id="cb21-1150"><a href="#cb21-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1151"><a href="#cb21-1151" aria-hidden="true" tabindex="-1"></a>The proposed **Federal YIMBY Housing Acceleration Act** directly addresses these disparities. It empowers municipalities to expand housing supply, reduce rent pressure, and improve quality of life — all while creating high-quality jobs in construction, real estate, and essential public sectors.  </span>
<span id="cb21-1152"><a href="#cb21-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1153"><a href="#cb21-1153" aria-hidden="true" tabindex="-1"></a>**Key takeaway:**  </span>
<span id="cb21-1154"><a href="#cb21-1154" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Sustainable growth is not only a matter of economics but of equity. By rewarding municipalities that make measurable progress on housing growth and rent burden reduction, Congress can create a new pathway to affordability for millions of Americans.</span></span>
<span id="cb21-1155"><a href="#cb21-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1156"><a href="#cb21-1156" aria-hidden="true" tabindex="-1"></a>In summary, this policy brief demonstrates that YIMBY principles—when supported by clear data and effective incentives—can make housing more affordable, communities more inclusive, and local economies more resilient.  </span>
<span id="cb21-1157"><a href="#cb21-1157" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>